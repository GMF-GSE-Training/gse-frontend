import{a as it}from"./chunk-SXWZLSUX.js";import{a as O}from"./chunk-4R45QQZ3.js";import{a as at,b as nt}from"./chunk-LFC2DQGM.js";import{a as tt}from"./chunk-Q5IFFAJN.js";import{a as et,b as de}from"./chunk-3Q2KUSXG.js";import{a as rt}from"./chunk-O5IUEWYX.js";import{b as Xe}from"./chunk-FBVENKOP.js";import{a as Ye}from"./chunk-3FGHHD2R.js";import{b as je,c as re,d as Ve,e as We,f as oe,g as Ue,h as $e,i as Ke,j as ze,k as se,n as He,o as E,p as Qe,q as Ge,s as pe,t as Je,u as le}from"./chunk-6ITL565O.js";import{b as Ze}from"./chunk-QKGMZ23H.js";import{a as z}from"./chunk-WUFTDP6O.js";import{a as S,b as M}from"./chunk-W5GHEU6T.js";import{a as L}from"./chunk-G57N2EQR.js";import{A as ye,B as Ae,C as B,b as Re,d as K,g as T,l as qe,p as ae,r as F,t as N,u as ne,z as Ce}from"./chunk-3V2U2C6V.js";import{Ab as Oe,Cb as q,Db as A,Eb as j,Fb as Ee,G as X,Gb as c,Hb as Le,Ja as Te,Ka as $,Kb as P,La as Fe,Lb as v,M as ee,Mb as w,Na as d,Ob as J,Pb as Z,R as Me,Ra as Ne,S as te,Sa as m,W as Ie,Xa as y,Ya as ie,a as W,ab as C,b as U,ba as u,ca as h,e as Pe,f as ve,hb as l,ib as Be,jb as x,ka as _e,nb as r,o as we,oa as ke,ob as s,pb as b,sb as k,t as Se,vb as g,wb as f,xb as De,yb as xe}from"./chunk-VF5RWILG.js";var I=(()=>{class a{constructor(e){this.http=e,this.apiUrl=ye.apiUrl,this.endpoints=ye.endpoints.participant}createParticipant(e){return this.http.post(`${this.apiUrl}/${this.endpoints.base}`,e,{withCredentials:!0})}getParticipantById(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}`,{withCredentials:!0})}updateParticipant(e,i){return this.http.patch(`${this.apiUrl}/${this.endpoints.base}/${e}`,i,{withCredentials:!0})}deleteParticipant(e){return this.http.delete(`${this.apiUrl}/${this.endpoints.base}/${e}`,{withCredentials:!0})}listParticipants(e,i,t){return this.http.get(`${this.apiUrl}/${this.endpoints.list}?q=${e}&page=${i}&size=${t}`,{withCredentials:!0})}getFile({id:e},i){return this.http.get(`${this.apiUrl}/participants/${e}/${i}`,{responseType:"blob",withCredentials:!0})}getFoto(e){return this.http.get(`${this.apiUrl}/participants/${e}/foto`,{responseType:"blob",withCredentials:!0})}getQrCode(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}/qr-code`,{responseType:"blob",withCredentials:!0})}downloadIdCard(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}/${this.endpoints.downloadIdCard}`,{withCredentials:!0,responseType:"blob"})}downloadDocument(e){return this.http.get(`${this.apiUrl}/${e}/download-id-card`,{withCredentials:!0,responseType:"blob"})}viewIdCard(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}/${this.endpoints.idCard}`,{responseType:"text",withCredentials:!0})}isDataComplete(e){return this.http.get(`${this.apiUrl}/${this.endpoints.isComplete}/${e}`,{withCredentials:!0})}downloadAllFiles(e){return this.http.get(`${this.apiUrl}/participants/${e}/download-all`,{withCredentials:!0,responseType:"blob"})}static{this.\u0275fac=function(i){return new(i||a)(Ie(qe))}}static{this.\u0275prov=Me({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var ce=(()=>{class a{constructor(e,i,t,n){this.participantService=e,this.sweetalertService=i,this.router=t,this.route=n,this.pageTitle="Participants",this.columns=[{header:"No Pegawai",field:"idNumber"},{header:"Nama",field:"name"},{header:"Dinas",field:"dinas"},{header:"Bidang",field:"bidang"},{header:"Perusahaan",field:"company"},{header:"Email",field:"email"},{header:"Action",field:"action"}],this.participants=[],this.isLoading=!1,this.currentPage=1,this.totalPages=1,this.itemsPerPage=10,this.searchQuery="",this.placeHolder="Cari Participant",this.roleBassedAccess=["super admin","supervisor","lcu"]}ngOnInit(){this.route.queryParams.subscribe(e=>{this.searchQuery=e.keyword||"",this.currentPage=+e.page||1,this.getListParticipants(this.searchQuery,this.currentPage,this.itemsPerPage)})}getListParticipants(e,i,t){this.isLoading=!0,this.participantService.listParticipants(e,i,t).subscribe({next:n=>{this.participants=this.mapParticipants(n),this.totalPages=n.paging?.totalPage??1},error:n=>{console.log(n),this.sweetalertService.alert("Pemberitahuan","Server sedang sibuk atau terjadi gangguan. Silakan coba beberapa saat lagi.","error"),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}deleteParticipant(e){return ve(this,null,function*(){(yield this.sweetalertService.confirm("Anda Yakin?",`Apakah anda ingin menghapus peserta ini : ${e.name}?`,"warning","Ya, hapus!"))&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.deleteParticipant(e.id).subscribe({next:()=>{this.sweetalertService.alert("Dihapus!","Data peserta berhasil dihapus","success"),this.participants=this.participants.filter(n=>n.id!==e.id),this.participants.length===0&&this.currentPage>0&&(this.currentPage-=1),this.getListParticipants(this.searchQuery,this.currentPage,this.itemsPerPage),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages);let t=this.searchQuery?{keyword:this.searchQuery,page:this.currentPage}:{page:this.currentPage};this.router.navigate([],{relativeTo:this.route,queryParams:t,queryParamsHandling:"merge"})},error:t=>{console.log(t),this.sweetalertService.alert("Gagal!","Terjadi kesalahan, coba lagi nanti","error")}}))})}onSearchChanged(e){e.trim()===""?this.router.navigate([],{queryParams:{keyword:null,page:null},queryParamsHandling:"merge"}):this.router.navigate([],{queryParams:{keyword:e,page:1},queryParamsHandling:"merge"})}onPageChanged(e){this.router.navigate([],{queryParams:{page:e},queryParamsHandling:"merge"})}viewAll(){this.participants.length>0,this.router.navigate([],{relativeTo:this.route,queryParams:{keyword:void 0,page:void 0},queryParamsHandling:"merge"}),this.searchQuery=""}mapParticipants(e){return e.data.map(i=>U(W({},i),{idNumber:i.idNumber??"-",dinas:i.dinas??"-",bidang:i.bidang??"-",company:i.company??"-",editLink:e.actions?.canEdit?`/participants/${i.id}/edit`:null,detailLink:e.actions?.canView?`/participants/${i.id}/detail`:null,deleteMethod:e.actions?.canDelete?()=>this.deleteParticipant(i):null}))}static{this.\u0275fac=function(i){return new(i||a)(m(I),m(B),m(N),m(F))}}static{this.\u0275cmp=y({type:a,selectors:[["app-participant-list"]],decls:2,vars:9,consts:[[3,"pageChange","searchChange","viewAllChange","pageTitle","columns","data","isLoading","totalPages","currentPage","placeHolder","blueButtonRoute","roleBassedAccess"]],template:function(i,t){i&1&&(b(0,"app-header"),r(1,"app-data-management",0),g("pageChange",function(p){return t.onPageChanged(p)})("searchChange",function(p){return t.onSearchChanged(p)})("viewAllChange",function(){return t.viewAll()}),s()),i&2&&(d(),l("pageTitle",t.pageTitle)("columns",t.columns)("data",t.participants)("isLoading",t.isLoading)("totalPages",t.totalPages)("currentPage",t.currentPage)("placeHolder",t.placeHolder)("blueButtonRoute","/participants/add")("roleBassedAccess",t.roleBassedAccess))},dependencies:[Xe,z],encapsulation:2})}}return a})();var ut=["*"];function ht(a,_){a&1&&(r(0,"span"),c(1,"*"),s())}function gt(a,_){if(a&1){let e=k();r(0,"input",7),w("ngModelChange",function(t){u(e);let n=f();return v(n.companyName,t)||(n.companyName=t),h(t)}),s()}if(a&2){let e=f();l("name",e.name)("required",e.showCompanyInput),P("ngModel",e.companyName)}}var V=(()=>{class a{constructor(){this.selectedCompany="",this.showCompanyInput=!1,this.companyName="",this.name="",this.isRequired=!1}ngOnInit(){this.selectedCompany||(this.selectedCompany="GMF",this.toggleCompanyInput())}toggleCompanyInput(){this.showCompanyInput=this.selectedCompany==="Non GMF"}getCompanyName(){return this.selectedCompany==="Non GMF"?this.companyName:"GMF"}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-company-input"]],inputs:{selectedCompany:"selectedCompany",showCompanyInput:"showCompanyInput",companyName:"companyName",name:"name",isRequired:"isRequired"},ngContentSelectors:ut,decls:11,vars:3,consts:[[1,"container"],["for","company-select"],[4,"ngIf"],["id","company-select",3,"ngModelChange","change","ngModel"],["value","GMF"],["value","Non GMF"],["type","text","id","company-input","placeholder","Nama Perusahaan",3,"name","required","ngModel","ngModelChange",4,"ngIf"],["type","text","id","company-input","placeholder","Nama Perusahaan",3,"ngModelChange","name","required","ngModel"]],template:function(i,t){i&1&&(De(),r(0,"div",0)(1,"label",1),c(2,"Perusahaan "),C(3,ht,2,0,"span",2),s(),r(4,"select",3),w("ngModelChange",function(p){return v(t.selectedCompany,p)||(t.selectedCompany=p),p}),g("change",function(){return t.toggleCompanyInput()}),r(5,"option",4),c(6,"GMF"),s(),r(7,"option",5),c(8,"Non GMF"),s()(),C(9,gt,1,3,"input",6),xe(10),s()),i&2&&(d(3),l("ngIf",t.isRequired),d(),P("ngModel",t.selectedCompany),d(5),l("ngIf",t.showCompanyInput))},dependencies:[E,Ke,ze,je,$e,re,se,oe,T,K],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{display:flex;margin-top:15px;font-weight:700;font-size:1em}select[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:25px;overflow:hidden;width:100%;margin-top:5px;border:3px solid #ccc;height:40px;font-weight:700;padding-left:8px;font-size:15px}span[_ngcontent-%COMP%]{color:red}@media (max-width: 768px){input[_ngcontent-%COMP%]{border:2px solid #ccc}}"]})}}return a})();var ft=["form"];function _t(a,_){a&1&&(r(0,"span",39),c(1,"SIM A wajib diunggah"),s())}function Ct(a,_){a&1&&(r(0,"span",39),c(1,"KTP wajib diunggah"),s())}function yt(a,_){a&1&&(r(0,"span",39),c(1,"Pas Foto wajib diunggah"),s())}function bt(a,_){a&1&&(r(0,"span",39),c(1,"Surat Ket. Sehat dan Buta Warna wajib diunggah"),s())}function Pt(a,_){a&1&&(r(0,"span",39),c(1,"Surat Ket. Bebas Narkoba wajib diunggah"),s())}var ue=(()=>{class a{constructor(){this.pageTitle="",this.participant={},this.isUpdate=!1,this.fileType=".png, .jpg, .jpeg, .pdf",this.fileTypeFoto=".png, .jpg, .jpeg",this.formSubmit=new _e,this.fileChange=new _e,this.selectedCompany="",this.companyName="",this.showCompanyInput=!1,this.backButtonRoute="/participants",this.cachedUserProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.currentUserRole=this.cachedUserProfile.role?.name}ngOnInit(){this.currentUserRole=this.cachedUserProfile.role?.name}onSubmit(){this.form.valid&&(this.participant.company=this.companyInputComponent.getCompanyName(),this.isUpdate?(this.cachedUserProfile&&this.currentUserRole!=="super admin"&&delete this.participant.email,this.formSubmit.emit(this.participant)):this.formSubmit.emit(this.participant))}onFileChange(e,i){e==="simA"&&(this.participant.simAFileName=i?i.name:null),this.fileChange.emit({property:e,file:i})}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-participant-form"]],viewQuery:function(i,t){if(i&1&&(q(V,5),q(ft,5)),i&2){let n;A(n=j())&&(t.companyInputComponent=n.first),A(n=j())&&(t.form=n.first)}},inputs:{pageTitle:"pageTitle",participant:"participant",isUpdate:"isUpdate",selectedCompany:"selectedCompany",companyName:"companyName",showCompanyInput:"showCompanyInput",backButtonRoute:"backButtonRoute"},outputs:{formSubmit:"formSubmit",fileChange:"fileChange"},decls:58,vars:57,consts:[["form","ngForm"],["name","ngModel"],["nik","ngModel"],["email","ngModel"],["phoneNumber","ngModel"],["nationality","ngModel"],["placeOfBirth","ngModel"],["dateOfBirth","ngModel"],["tglKeluarSuratSehatButaWarna","ngModel"],["tglKeluarSuratBebasNarkoba","ngModel"],[1,"container"],[3,"pageTitle"],[3,"ngSubmit"],[1,"form-container"],[1,"left-column"],["name","idNumber","label","No Pegawai","placeholder","No Pegawai","type","text","autocomplete","on","inputMode","tel",3,"ngModelChange","ngModel"],["name","name","label","Nama","placeholder","Masukkan nama asli, nama akan digunakan pada data sertifikat","type","text","autocomplete","name","inputMode","text","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],["name","nik","label","NIK/Paspor","placeholder","Masukkan NIK/Paspor","type","text","autocomplete","off","inputMode","text","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],["name","dinas","label","Dinas","placeholder","Dinas","type","text","autocomplete","off","inputMode","text",3,"ngModelChange","ngModel"],["name","bidang","label","Bidang","placeholder","Bidang","type","text","autocomplete","off","inputMode","text",3,"ngModelChange","ngModel"],[3,"selectedCompany","companyName","showCompanyInput","isRequired"],["name","email","label","Email","placeholder","Gunakan email aktif","type","email","autocomplete","email","inputMode","text",3,"ngModelChange","ngModel","isRequired","disabled"],["name","phoneNumber","label","Nomor Telepon","placeholder","Gunakan nomor telepon aktif","type","tel","autocomplete","tel","inputMode","tel","pattern","^[0-9+\\- ]+$","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern"],["name","nationality","label","Kewarganegaraan","placeholder","Isi kewarganegaraan sesuai KTP/Paspor","type","text","autocomplete","country-name","inputMode","text",3,"ngModelChange","ngModel","isRequired"],["name","placeOfBirth","label","Tempat Lahir","placeholder","Isi Tempat Lahir sesuai KTP/Paspor","type","text","autocomplete","address-level2","inputMode","text",3,"ngModelChange","ngModel","isRequired"],[1,"right-column"],["name","dateOfBirth","label","Tanggal Lahir","type","date","inputmode","date","defaultMessage","Isi Tanggal Lahir sesuai KTP/Paspor",3,"ngModelChange","ngModel","isRequired"],["idInput","sim_a_input","label","SIM A",3,"valueChange","isRequired","fileName","fileType","required"],["class","error-message",4,"ngIf"],["idInput","sim_b_input","label","SIM B",3,"valueChange","fileName","fileType"],["idInput","ktp_input","label","KTP/Paspor",3,"valueChange","isRequired","fileName","fileType"],["idInput","foto_input","label","Pas Foto",3,"valueChange","isRequired","fileName","fileType"],["idInput","surat_sehat_input","label","Surat Ket. Sehat dan Buta Warna",3,"valueChange","isRequired","fileName","fileType"],["name","tglKeluarSuratSehatButaWarna","label","Tanggal Pembuatan Surat Ket. Sehat & Buta Warna","defaultMessage","Masukkan tanggal keluar surat sehat sesuai dengan tanggal keluar surat yang diunggah","type","date","inputmode","date","required","",3,"ngModelChange","ngModel","isRequired"],["idInput","surat_bebas_narkoba_input","label","Surat Ket. Bebas Narkoba",3,"valueChange","isRequired","fileName","fileType"],["name","tglKeluarSuratBebasNarkoba","label","Tanggal Pembuatan Surat Ket. Bebas Narkoba","defaultMessage","Masukkan tanggal keluar surat sehat sesuai dengan tanggal keluar surat yang diunggah","type","date","inputmode","date","required","",3,"ngModelChange","ngModel","isRequired"],[1,"buttons-container"],["type","button",1,"button",3,"routerLink"],["type","submit",1,"button",3,"disabled"],[1,"error-message"]],template:function(i,t){if(i&1){let n=k();b(0,"app-header"),r(1,"div",10),b(2,"app-title",11),r(3,"form",12,0),g("ngSubmit",function(){return u(n),h(t.onSubmit())}),r(5,"div",13)(6,"div",14)(7,"app-base-input",15),w("ngModelChange",function(o){return u(n),v(t.participant.idNumber,o)||(t.participant.idNumber=o),h(o)}),s(),r(8,"app-base-input",16,1),w("ngModelChange",function(o){return u(n),v(t.participant.name,o)||(t.participant.name=o),h(o)}),s(),r(10,"app-base-input",17,2),w("ngModelChange",function(o){return u(n),v(t.participant.nik,o)||(t.participant.nik=o),h(o)}),s(),r(12,"app-base-input",18),w("ngModelChange",function(o){return u(n),v(t.participant.dinas,o)||(t.participant.dinas=o),h(o)}),s(),r(13,"app-base-input",19),w("ngModelChange",function(o){return u(n),v(t.participant.bidang,o)||(t.participant.bidang=o),h(o)}),s(),b(14,"app-company-input",20),r(15,"app-base-input",21,3),w("ngModelChange",function(o){return u(n),v(t.participant.email,o)||(t.participant.email=o),h(o)}),s(),r(17,"app-base-input",22,4),w("ngModelChange",function(o){return u(n),v(t.participant.phoneNumber,o)||(t.participant.phoneNumber=o),h(o)}),s(),r(19,"app-base-input",23,5),w("ngModelChange",function(o){return u(n),v(t.participant.nationality,o)||(t.participant.nationality=o),h(o)}),s(),r(21,"app-base-input",24,6),w("ngModelChange",function(o){return u(n),v(t.participant.placeOfBirth,o)||(t.participant.placeOfBirth=o),h(o)}),s()(),r(23,"div",25)(24,"app-base-input",26,7),w("ngModelChange",function(o){return u(n),v(t.participant.dateOfBirth,o)||(t.participant.dateOfBirth=o),h(o)}),s(),r(26,"app-file-input",27),g("valueChange",function(o){return u(n),h(t.onFileChange("simA",o))}),s(),C(27,_t,2,0,"span",28),r(28,"span"),c(29,"Format png, jpg, jpeg, atau pdf."),s(),r(30,"app-file-input",29),g("valueChange",function(o){return u(n),h(t.onFileChange("simB",o))}),s(),r(31,"span"),c(32,"Format png, jpg, jpeg, atau pdf."),s(),r(33,"app-file-input",30),g("valueChange",function(o){return u(n),h(t.onFileChange("ktp",o))}),s(),C(34,Ct,2,0,"span",28),r(35,"span"),c(36,"Format png, jpg, jpeg, atau pdf."),s(),r(37,"app-file-input",31),g("valueChange",function(o){return u(n),h(t.onFileChange("foto",o))}),s(),C(38,yt,2,0,"span",28),r(39,"span"),c(40,"Format png, jpg, atau jpeg. ukuran 3x4."),s(),r(41,"app-file-input",32),g("valueChange",function(o){return u(n),h(t.onFileChange("suratSehatButaWarna",o))}),s(),C(42,bt,2,0,"span",28),r(43,"span"),c(44,"Format png, jpg, jpeg, atau pdf."),s(),r(45,"app-base-input",33,8),w("ngModelChange",function(o){return u(n),v(t.participant.tglKeluarSuratSehatButaWarna,o)||(t.participant.tglKeluarSuratSehatButaWarna=o),h(o)}),s(),r(47,"app-file-input",34),g("valueChange",function(o){return u(n),h(t.onFileChange("suratBebasNarkoba",o))}),s(),C(48,Pt,2,0,"span",28),r(49,"span"),c(50,"Format png, jpg, jpeg, atau pdf."),s(),r(51,"app-base-input",35,9),w("ngModelChange",function(o){return u(n),v(t.participant.tglKeluarSuratBebasNarkoba,o)||(t.participant.tglKeluarSuratBebasNarkoba=o),h(o)}),s()()(),r(53,"div",36)(54,"app-white-button",37),c(55,"Kembali"),s(),r(56,"app-blue-button",38),c(57," Simpan "),s()()()()}if(i&2){let n=Ee(4);d(2),l("pageTitle",t.pageTitle),d(5),P("ngModel",t.participant.idNumber),d(),P("ngModel",t.participant.name),l("isRequired",!0)("restrictToPattern","^[a-zA-Z ]+$")("pattern","^[a-zA-Z ]+$"),d(2),P("ngModel",t.participant.nik),l("isRequired",!0)("restrictToPattern","^[0-9]+$")("pattern","^[0-9]+$"),d(2),P("ngModel",t.participant.dinas),d(),P("ngModel",t.participant.bidang),d(),l("selectedCompany",t.selectedCompany)("companyName",t.companyName)("showCompanyInput",t.showCompanyInput)("isRequired",!0),d(),P("ngModel",t.participant.email),l("isRequired",!0)("disabled",t.isUpdate&&(!t.currentUserRole||t.currentUserRole!=="super admin")),d(2),P("ngModel",t.participant.phoneNumber),l("isRequired",!0)("restrictToPattern","^[0-9-+ ]+$"),d(2),P("ngModel",t.participant.nationality),l("isRequired",!0),d(2),P("ngModel",t.participant.placeOfBirth),l("isRequired",!0),d(3),P("ngModel",t.participant.dateOfBirth),l("isRequired",!0),d(2),l("isRequired",!0)("fileName",t.participant.simAFileName)("fileType",t.fileType)("required",t.participant.simAFileName),d(),l("ngIf",!t.participant.simAFileName&&n.submitted),d(3),l("fileName",t.participant.simBFileName)("fileType",t.fileType),d(3),l("isRequired",!0)("fileName",t.participant.ktpFileName)("fileType",t.fileType),d(),l("ngIf",!t.participant.ktpFileName&&n.submitted),d(3),l("isRequired",!0)("fileName",t.participant.fotoFileName)("fileType",t.fileTypeFoto),d(),l("ngIf",!t.participant.fotoFileName&&n.submitted),d(3),l("isRequired",!0)("fileName",t.participant.suratSehatButaWarnaFileName)("fileType",t.fileType),d(),l("ngIf",!t.participant.suratSehatButaWarnaFileName&&n.submitted),d(3),P("ngModel",t.participant.tglKeluarSuratSehatButaWarna),l("isRequired",!0),d(2),l("isRequired",!0)("fileName",t.participant.suratBebasNarkobaFileName)("fileType",t.fileType),d(),l("ngIf",!t.participant.suratBebasNarkobaFileName&&n.submitted),d(3),P("ngModel",t.participant.tglKeluarSuratBebasNarkoba),l("isRequired",!0),d(3),l("routerLink",t.backButtonRoute),d(2),l("disabled",n.invalid||!t.participant.simA||!t.participant.ktp||!t.participant.foto||!t.participant.suratSehatButaWarna||!t.participant.suratBebasNarkoba)}},dependencies:[et,V,le,pe,Je,ne,E,Ue,re,Ve,se,He,oe,We,Ge,T,K,z],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}form[_ngcontent-%COMP%]{background:#fff;padding:2em;border:1px solid #e0e0e0;border-radius:8px;max-width:100%}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:48%}span[_ngcontent-%COMP%]{margin-left:15px;margin-top:3px;font-size:14px}.error-message[_ngcontent-%COMP%]{color:red}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:2em 1em}form[_ngcontent-%COMP%]{padding:1em}.form-container[_ngcontent-%COMP%]{display:block}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();var he=(()=>{class a{constructor(e,i,t,n){this.router=e,this.participantService=i,this.sweetalertService=t,this.errorHandlerService=n,this.createParticipant={idNumber:"",name:"",nik:"",dinas:"",bidang:"",company:"",email:"",phoneNumber:"",nationality:"",placeOfBirth:"",dateOfBirth:"",simA:null,simAFileName:"",simB:null,simBFileName:"",ktp:null,ktpFileName:"",foto:null,fotoFileName:"",suratSehatButaWarna:null,suratSehatButaWarnaFileName:"",suratBebasNarkoba:null,suratBebasNarkobaFileName:"",tglKeluarSuratSehatButaWarna:"",tglKeluarSuratBebasNarkoba:""},this.requiredFields=["name","company","email","phoneNumber","kewarganegaraan","placeOfBirth","dateOfBirth","simA","ktp","foto","suratSehatButaWarna","tglKeluarSuratSehatButaWarna","suratBebasNarkoba","tglKeluarSuratSehatBebasNarkoba"]}onCreate(e){let i=this.prepareFormData(e);this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.createParticipant(i).subscribe({next:t=>{let n=t.data;this.sweetalertService.alert("Ditambahkan!","Peserta berhasil ditambahkan","success"),this.router.navigateByUrl("/users/add",{state:{id:n.id,idNumber:n.idNumber,nik:n.nik,email:n.email,name:n.name,dinas:n.dinas}})},error:t=>{this.errorHandlerService.alertError(t,this.requiredFields)}})}onFileChange(e,i){if(i){this.createParticipant[e]=i;let t=`${e}FileName`;this.createParticipant[t]=i.name}}prepareFormData(e){let i=new FormData;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];n==null&&(n=""),(n instanceof File||n)&&i.append(t,n)}return i}static{this.\u0275fac=function(i){return new(i||a)(m(N),m(I),m(B),m(L))}}static{this.\u0275cmp=y({type:a,selectors:[["app-add-participant-data"]],viewQuery:function(i,t){if(i&1&&q(V,5),i&2){let n;A(n=j())&&(t.companyInputComponent=n.first)}},decls:1,vars:2,consts:[[3,"formSubmit","fileChange","pageTitle","participant"]],template:function(i,t){i&1&&(r(0,"app-participant-form",0),g("formSubmit",function(p){return t.onCreate(p)})("fileChange",function(p){return t.onFileChange(p.property,p.file)}),s()),i&2&&l("pageTitle","Add Participant Data")("participant",t.createParticipant)},dependencies:[E,ue],encapsulation:2})}}return a})();var pt=Pe(it());var vt=()=>["super admin","supervisor","lcu"],wt=()=>["user"],St=()=>["super admin","lcu","supervisor"],Mt=()=>["super admin","lcu","user"],st=a=>({active:a}),It=a=>["/participants",a,"profile","personal"],kt=a=>["/participants",a,"profile","account"];function Tt(a,_){a&1&&b(0,"app-loader")}function Ft(a,_){a&1&&(r(0,"div",22),c(1,"Data peserta tidak ditemukan."),s())}function Nt(a,_){if(a&1&&b(0,"img",5),a&2){let e=f(2);Oe("src","data:",e.photoType,"/;base64,",e.pasFoto,"",$)}}function Bt(a,_){if(a&1&&(r(0,"span",23)(1,"span"),c(2,"Cetak Kartu Peserta"),s()()),a&2){let e=f(2);l("routerLink",e.idCardLink)}}function Dt(a,_){if(a&1&&(r(0,"div",24)(1,"div",25),b(2,"i",26),r(3,"span"),c(4,"Data Pribadi"),s()(),r(5,"div",25),b(6,"i",27),r(7,"span"),c(8,"Akun"),s()()()),a&2){let e=f(2);d(),l("ngClass",Z(4,st,e.selectedItem===0))("routerLink",Z(6,It,e.id)),d(4),l("ngClass",Z(8,st,e.selectedItem===1))("routerLink",Z(10,kt,e.id))}}function xt(a,_){if(a&1){let e=k();r(0,"app-vertical-table",28),g("downloadDocumentClick",function(){u(e);let t=f(2);return h(t.downloadDocument())}),s()}if(a&2){let e=f(2);l("isParticipantDetail",!0)("data",e.verticalTableData)}}function Ot(a,_){if(a&1){let e=k();r(0,"div",17)(1,"div",29)(2,"app-email-form-card",30),g("formSubmit",function(t){u(e);let n=f(2);return h(n.updateEmailSubmit(t))}),s()(),r(3,"div",29)(4,"app-password-update-form-card",31),g("formSubmit",function(t){u(e);let n=f(2);return h(n.updatePasswordSubmit(t))}),s()()()}}function Et(a,_){if(a&1&&(r(0,"app-white-button",32),c(1,"Kembali"),s()),a&2){let e=f(2);l("routerLink",e.backButtonRoute||"/participants")}}function Lt(a,_){if(a&1&&(r(0,"app-blue-button",32),c(1,"Edit"),s()),a&2){let e=f(2);l("routerLink",e.editLink)}}function Rt(a,_){if(a&1&&(C(0,Ft,2,0,"div",1),r(1,"div",2)(2,"div",3)(3,"div",4),C(4,Nt,1,3,"img",5),s(),r(5,"div",6)(6,"h2"),c(7),s()()(),r(8,"div",7)(9,"div",8),b(10,"img",9),s(),r(11,"div",10),C(12,Bt,3,1,"span",11),r(13,"span")(14,"a",12),c(15,"Download"),s()()()()(),r(16,"div",13),C(17,Dt,9,12,"div",14),r(18,"div",15),C(19,xt,1,2,"app-vertical-table",16)(20,Ot,5,0,"div",17),s()(),r(21,"div",18),b(22,"app-table",19),s(),r(23,"div",20),C(24,Et,2,1,"app-white-button",21)(25,Lt,2,1,"app-blue-button",21),s()),a&2){let e=f();l("ngIf",!e.participant&&!e.isLoading),d(4),x(e.pasFoto?4:-1),d(3),Le(e.participant==null?null:e.participant.name),d(3),l("src",e.qrCode,$),d(2),l("appRoleBasedAccess",J(13,vt)),d(2),l("href",e.qrCode,$)("download",e.qrCodeDownloadName),d(3),l("appRoleBasedAccess",J(14,wt)),d(2),x(e.selectedItem===0?19:e.selectedItem===1?20:-1),d(3),l("columns",e.columns)("data",e.data),d(2),l("appRoleBasedAccess",J(15,St)),d(),l("appRoleBasedAccess",J(16,Mt))}}var Q=(()=>{class a{constructor(e,i,t,n,p,o){this.route=e,this.router=i,this.participantService=t,this.authService=n,this.sweetalertService=p,this.errorHandlerService=o,this.participant=null,this.verticalTableData=[],this.editLink="",this.photoType=null,this.backButtonRoute="/participants",this.selectedItem=0,this.isLoading=!1,this.pasFoto=localStorage.getItem("pas_foto"),this.qrCode=localStorage.getItem("qr_code"),this.qrCodeDownloadName="QR_Code.png",this.id=this.route.snapshot.paramMap.get("participantId")||JSON.parse(localStorage.getItem("user_profile")||"{}").participant.id,this.idCardLink="",this.dateOptions={day:"numeric",month:"long",year:"numeric"},this.columns=[{header:"Kompetensi",field:"trainingName"},{header:"Exp Sertifikat",field:"exp"}],this.data=[{trainingName:"Forklift",exp:"10 February 2026"},{trainingName:"Regulasi GSE",exp:"10 February 2026"},{trainingName:"Baggage Towing Tractor",exp:"10 February 2026"},{trainingName:"Air Conditioning System Refreshment",exp:"10 February 2026"}],this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.updateEmail={email:""};let G=this.router.getCurrentNavigation()?.extras.state;G&&(this.backButtonRoute=G.data)}ngOnInit(){this.route.queryParams.subscribe(e=>{e.error?(this.sweetalertService.alert("Gagal",e.error,"error"),this.router.navigate([],{relativeTo:this.route,queryParams:{error:null},queryParamsHandling:"merge"})):e.success&&(this.sweetalertService.alert("Sukses",e.success,"success"),this.getParticipantById(),this.router.navigate([],{relativeTo:this.route,queryParams:{success:null},queryParamsHandling:"merge"}))}),this.route.url.subscribe(e=>{let i=e.map(t=>t.path).join("/");this.selectedItem=i===`participants/${this.id}/profile/personal`?0:i===`participants/${this.id}/profile/account`?1:0}),this.userProfile.role.name==="user"?this.id!==this.userProfile.participant.id?this.getParticipantById():this.getParticipantFromLocalStorage():this.getParticipantById()}getParticipantFromLocalStorage(){this.isLoading=!0,this.participant=this.userProfile.participant,this.participant&&this.setParticipantData(this.participant),this.isLoading=!1}getParticipantById(){this.isLoading=!0,this.participantService.getParticipantById(this.id).subscribe({next:e=>{e.data?this.setParticipantData(e.data):this.participant=null},error:e=>{console.error(e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}getFoto(e){this.participantService.getFoto(e).pipe(Se(i=>new Promise((t,n)=>{let p=new FileReader;p.onloadend=()=>t(p.result),p.onerror=n,p.readAsDataURL(i)})),ee(i=>we(i))).subscribe({next:i=>{this.photoType=this.getMediaType(i),this.pasFoto=i.split(",")[1],this.userProfile.role.name==="user"&&localStorage.setItem("pas_foto",this.pasFoto)},error:i=>console.error("Error fetching photo:",i)})}getQrCode(e){this.participantService.getQrCode(e).subscribe({next:i=>{let t=new FileReader;t.onloadend=()=>{this.qrCode=t.result,this.userProfile.role.name==="user"&&localStorage.setItem("qr_code",this.qrCode)},t.readAsDataURL(i)},error:i=>console.error("Error fetching QR code:",i)})}downloadDocument(){this.id&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.downloadAllFiles(this.id).subscribe({next:e=>{let i=`AllFiles_${this.participant?.name?.replace(/\s+/g,"_")||"Participant"}_${this.id}.zip`;(0,pt.default)(e,i),this.sweetalertService.close()},error:e=>{this.sweetalertService.close(),this.sweetalertService.alert("Gagal!","Data tidak ditemukan.","error")}}))}updateEmailSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updateEmailRequest(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil",`Kami telah mengirimkan email verifikasi ke ${e.email}. Silakan buka tautan untuk menyelesaikan proses.`,"success")},error:i=>this.errorHandlerService.alertError(i)})}updatePasswordSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updatePassword(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil","Password berhasil diubah","success")},error:i=>this.errorHandlerService.alertError(i)})}setParticipantData(e){this.participant=e,this.verticalTableData=this.transformData(this.participant),this.editLink=`/participants/${this.id}/edit`,this.idCardLink=`/participants/${this.id}/id-card`,this.qrCodeDownloadName=`QR_Code_${e.name.replace(/ /g,"_")}_${e.id}.png`,this.userProfile.role.name==="user"&&localStorage.setItem("user_profile",JSON.stringify(U(W({},this.userProfile),{participant:this.participant}))),this.participant&&(this.getFoto(this.participant.id),this.getQrCode(this.participant.id))}transformData(e){return[{label:"No Pegawai",value:e.idNumber??"-"},{label:"Nama Peserta",value:e.name},{label:"Dinas",value:e.dinas??"-"},{label:"Bidang",value:e.bidang??"-"},{label:"Perusahaan",value:e.company??"-"},{label:"Email",value:e.email},{label:"No Telp",value:e.phoneNumber??"-"},{label:"Tempat Lahir",value:e.placeOfBirth??"-"},{label:"Tanggal Lahir",value:new Date(e.dateOfBirth).toLocaleDateString("id-ID",this.dateOptions)},{label:"SIM A",link:`/participants/${e.id}/sim-a`},{label:"SIM B",link:`/participants/${e.id}/sim-b`},{label:"KTP",link:`/participants/${e.id}/ktp`},{label:"Exp Surat Sehat & Buta Warna",value:new Date(new Date(e.tglKeluarSuratSehatButaWarna).setMonth(new Date(e.tglKeluarSuratSehatButaWarna).getMonth()+6)).toLocaleDateString("id-ID",this.dateOptions),link:`/participants/${e.id}/surat-sehat-buta-warna`},{label:"Exp Surat Bebas Narkoba",value:new Date(new Date(e.tglKeluarSuratBebasNarkoba).setMonth(new Date(e.tglKeluarSuratBebasNarkoba).getMonth()+6)).toLocaleDateString("id-ID",this.dateOptions),link:`/participants/${e.id}/surat-bebas-narkoba`}]}getMediaType(e){let i=e.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);return i&&i.length>0?i[1]:""}static{this.\u0275fac=function(i){return new(i||a)(m(F),m(N),m(I),m(Ae),m(B),m(L))}}static{this.\u0275cmp=y({type:a,selectors:[["app-participant-detail"]],decls:4,vars:3,consts:[[1,"container"],["class","error-message",4,"ngIf"],[1,"section"],[1,"profile-section"],[1,"photo"],["alt","Profile Picture",1,"file",3,"src"],[1,"name"],[1,"qr-section"],[1,"qr-code"],["alt","QR Code",1,"file",3,"src"],[1,"download"],[3,"routerLink",4,"appRoleBasedAccess"],[3,"href","download"],[1,"data-section"],["class","settings-nav",4,"appRoleBasedAccess"],[1,"card"],[3,"isParticipantDetail","data"],[1,"account-form"],[1,"certificate-table"],[3,"columns","data"],[1,"button-container"],["class","button",3,"routerLink",4,"appRoleBasedAccess"],[1,"error-message"],[3,"routerLink"],[1,"settings-nav"],[1,"menu-setting-item",3,"ngClass","routerLink"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-user-gear"],[3,"downloadDocumentClick","isParticipantDetail","data"],[1,"form-content"],["cardTitle","Ubah Email",3,"formSubmit"],["cardTitle","Ubah Password",3,"formSubmit"],[1,"button",3,"routerLink"]],template:function(i,t){i&1&&(b(0,"app-header"),r(1,"div",0),C(2,Tt,1,0,"app-loader")(3,Rt,26,17),s()),i&2&&(d(),Be("loading",t.isLoading),d(),x(t.isLoading?2:3))},dependencies:[ne,pe,tt,Ze,Ye,T,Re,K,le,at,nt,rt,z],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}.container.loading[_ngcontent-%COMP%]{justify-content:center;align-items:center;height:50%;width:100%}.section[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:40%}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.photo[_ngcontent-%COMP%]{max-width:148px;max-height:100%}.name[_ngcontent-%COMP%]{font-size:1em;margin-top:10px}.qr-section[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1em}.file[_ngcontent-%COMP%]{width:100%;height:100%}.file.blank[_ngcontent-%COMP%]{border:1px solid #fff}.qr-code[_ngcontent-%COMP%]{max-width:180px;max-height:180px}.download[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:25px;font-size:1em;font-weight:700;text-decoration:underline}.data-section[_ngcontent-%COMP%]{display:flex;gap:1em}.settings-nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:top;font-size:1em;width:12%}.settings-nav[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:50px}.menu-setting-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px;cursor:pointer;transition:background-color .2s ease,border-left .2s ease}.menu-setting-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:1em}.menu-setting-item[_ngcontent-%COMP%]:hover{background-color:#d8dadb}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:5px solid #02507E}.card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;height:100%;width:100%;background-color:#fff}.account-form[_ngcontent-%COMP%]{display:flex;padding:20px;gap:5%}.form-content[_ngcontent-%COMP%]{margin:0;width:100%;height:auth;padding-right:10%}.certificate-table[_ngcontent-%COMP%]{width:100%;padding:20px;border:1px solid #e0e0e0;border-radius:8px;background-color:#fff}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%}.button[_ngcontent-%COMP%]{width:190px;height:45px}.download[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000}.download[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{cursor:pointer;color:#266e99}.section[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center}.section[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{cursor:pointer;color:#266e99}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:1em}.qr-section[_ngcontent-%COMP%]{flex-direction:column}.data-section[_ngcontent-%COMP%]{flex-direction:column;gap:1em}.settings-nav[_ngcontent-%COMP%]{flex-direction:row;width:50%}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:none;border-bottom:5px solid #02507E}.account-form[_ngcontent-%COMP%]{flex-direction:column;gap:3em}}"]})}}return a})();var ge=(()=>{class a{constructor(e,i,t,n,p){this.route=e,this.router=i,this.participantService=t,this.sweetalertService=n,this.errorHandlerService=p,this.updateParticipant={idNumber:"",name:"",nik:"",dinas:"",bidang:"",company:"",phoneNumber:"",nationality:"",placeOfBirth:"",dateOfBirth:"",simA:null,simAFileName:"",simB:null,simBFileName:"",ktp:null,ktpFileName:"",foto:null,fotoFileName:"",suratSehatButaWarna:null,suratSehatButaWarnaFileName:"",suratBebasNarkoba:null,suratBebasNarkobaFileName:"",tglKeluarSuratSehatButaWarna:null,tglKeluarSuratBebasNarkoba:null},this.participantId=this.route.snapshot.paramMap.get("participantId"),this.selectedCompany="",this.companyName="",this.showCompanyInput=!1,this.requiredFields=["name","company","email","phoneNumber","kewarganegaraan","placeOfBirth","dateOfBirth","simA","ktp","foto","suratSehatButaWarna","tglKeluarSuratSehatButaWarna","suratBebasNarkoba","tglKeluarSuratSehatBebasNarkoba"],this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.id=this.route.snapshot.paramMap.get("participantId")||this.userProfile.participant.id,this.backButtonRoute="/participants"}ngOnInit(){this.participantId&&this.userProfile!=="{}"&&(this.userProfile.role==="user"?this.getParticipantFromLocalStorage():this.getParticipantById()),this.route.queryParams.subscribe(e=>{e.showAlert&&(this.sweetalertService.alert("Peringatan","Anda tidak bisa mengakses halaman lain sebelum melengkapi data","warning"),this.router.navigate([],{relativeTo:this.route,queryParams:{showAlert:null},queryParamsHandling:"merge"}))}),this.id&&this.userProfile.role.name==="user"&&(this.backButtonRoute=`/participants/${this.id}/profile/personal`)}getParticipantFromLocalStorage(){let e=this.userProfile.participant;e&&this.setParticipantData(e)}getParticipantById(){this.participantId&&this.participantService.getParticipantById(this.participantId).subscribe({next:e=>{let i=e.data;i&&this.setParticipantData(i)},error:e=>console.log(e)})}onUpdate(e){if(this.participantId){let i=this.prepareFormData(e);this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.updateParticipant(this.participantId,i).subscribe({next:()=>{this.sweetalertService.alert("Diperbarui!","Peserta berhasil diperbarui","success");let t=this.userProfile.participant;if(t){let n=t.email;this.userProfile.participant=JSON.parse(JSON.stringify(e,(p,o)=>o instanceof File||o===null?void 0:o)),this.userProfile.participant.email=n,this.userProfile.isDataComplete=!0,localStorage.setItem("user_profile",JSON.stringify(this.userProfile))}this.userProfile.role.name==="user"?(localStorage.removeItem("pas_foto"),localStorage.removeItem("qr_code"),this.router.navigateByUrl(`/participants/${this.participantId}/profile/personal`)):this.router.navigateByUrl(`/participants/${this.participantId}/detail`)},error:t=>{console.log(t),this.errorHandlerService.alertError(t,this.requiredFields)}})}}onFileChange(e,i){if(i){this.updateParticipant[e]=i;let t=`${e}FileName`;this.updateParticipant[t]=i.name}}setParticipantData(e){this.updateParticipant=U(W({},e),{dateOfBirth:this.formatDateToISO(e.dateOfBirth),tglKeluarSuratSehatButaWarna:this.formatDateToISO(e.tglKeluarSuratSehatButaWarna),tglKeluarSuratBebasNarkoba:this.formatDateToISO(e.tglKeluarSuratBebasNarkoba)}),this.selectedCompany=e.gmfNonGmf?e.gmfNonGmf:e.company,(e.gmfNonGmf!=="GMF"||e.company!=="GMF")&&(this.companyName=e.company,this.showCompanyInput=!!this.companyName,this.companyName||(this.selectedCompany="GMF",this.companyName="GMF",this.showCompanyInput=!1))}prepareFormData(e){let i=new FormData;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];n==null&&(n=""),n instanceof File,i.append(t,n)}return i}formatDateToISO(e){return new Date(e).toISOString().split("T")[0]}static{this.\u0275fac=function(i){return new(i||a)(m(F),m(N),m(I),m(B),m(L))}}static{this.\u0275cmp=y({type:a,selectors:[["app-edit-participant-data"]],viewQuery:function(i,t){if(i&1&&q(V,5),i&2){let n;A(n=j())&&(t.companyInputComponent=n.first)}},inputs:{selectedCompany:"selectedCompany",companyName:"companyName",showCompanyInput:"showCompanyInput"},decls:1,vars:7,consts:[[3,"formSubmit","fileChange","pageTitle","selectedCompany","companyName","showCompanyInput","participant","isUpdate","backButtonRoute"]],template:function(i,t){i&1&&(r(0,"app-participant-form",0),g("formSubmit",function(p){return t.onUpdate(p)})("fileChange",function(p){return t.onFileChange(p.property,p.file)}),s()),i&2&&l("pageTitle","Edit Participant Data")("selectedCompany",t.selectedCompany)("companyName",t.companyName)("showCompanyInput",t.showCompanyInput)("participant",t.updateParticipant)("isUpdate",!0)("backButtonRoute",t.backButtonRoute)},dependencies:[ue],encapsulation:2})}}return a})();var lt=Pe(it());function At(a,_){if(a&1&&b(0,"div",1),a&2){let e=f();l("innerHTML",e.id_card,Te)}}function jt(a,_){a&1&&(r(0,"div",2)(1,"p"),c(2,"ID Card Error. Silahkan cek kembali apakah data anda sudah lengkap atau belum."),s()())}var fe=(()=>{class a{constructor(e,i,t,n,p){this.route=e,this.participantService=i,this.sanitizer=t,this.sweetalertService=n,this.errorHandlerService=p,this.id_card="",this.id=this.route.snapshot.paramMap.get("participantId"),this.navigationLink=`/participants/${this.id}/detail`,this.isLoading=!1}ngOnInit(){this.getIdCard()}getIdCard(){if(!this.id){this.sweetalertService.alert("Peringatan","ID tidak ditemukan.","warning");return}this.isLoading=!0,this.participantService.viewIdCard(this.id).subscribe({next:e=>{this.id_card=this.sanitizer.bypassSecurityTrustHtml(e)},error:e=>{console.log(e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}downloadIdCard(){if(!this.id){this.sweetalertService.alert("Peringatan","ID tidak ditemukan.","warning");return}this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.getParticipantById(this.id).pipe(X(()=>this.sweetalertService.close())).subscribe({next:e=>{if(e.data){let n=`ID_Card_${e.data.name.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"")}_${this.id}.pdf`;this.participantService.downloadIdCard(this.id).subscribe({next:p=>{p?((0,lt.saveAs)(p,n),console.log(`File saved as: ${n}`)):this.sweetalertService.alert("Gagal!","Tidak ada data untuk diunduh.","error")},error:p=>{console.error("Error saat mengunduh ID Card:",p),this.errorHandlerService.alertError(p)}})}else this.sweetalertService.alert("Gagal!","Data peserta tidak ditemukan.","error")},error:e=>{console.error("Error saat mengambil detail peserta:",e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(i){return new(i||a)(m(F),m(I),m(ae),m(B),m(L))}}static{this.\u0275cmp=y({type:a,selectors:[["app-id-card"]],decls:3,vars:3,consts:[["pageTitle","ID Card",3,"downloadChange","isLoading","navigationLinks"],[3,"innerHTML"],[1,"no-files"]],template:function(i,t){i&1&&(r(0,"app-display-files",0),g("downloadChange",function(){return t.downloadIdCard()}),C(1,At,1,1,"div",1)(2,jt,3,0,"div",2),s()),i&2&&(l("isLoading",t.isLoading)("navigationLinks",t.navigationLink),d(),x(t.id_card?1:2))},dependencies:[de],styles:[".no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}"]})}}return a})();function Vt(a,_){if(a&1){let e=k();r(0,"embed",4),g("load",function(){u(e);let t=f(2);return h(t.onImageLoad())})("error",function(){u(e);let t=f(2);return h(t.onImageError())}),s()}if(a&2){let e=f(2);l("src",e.safeUrl,Fe)}}function Wt(a,_){if(a&1){let e=k();r(0,"img",5),g("load",function(){u(e);let t=f(2);return h(t.onImageLoad())})("error",function(){u(e);let t=f(2);return h(t.onImageError())}),s()}if(a&2){let e=f(2);l("src",e.safeUrl,$)}}function Ut(a,_){if(a&1&&C(0,Vt,1,1,"embed",2)(1,Wt,1,1,"img",3),a&2){let e=f();x(e.fileType==="application/pdf"?0:1)}}function $t(a,_){a&1&&(r(0,"div",1)(1,"p"),c(2,"File tidak ditemukan!!"),s()())}var R=(()=>{class a{constructor(e,i,t,n,p,o){this.route=e,this.participantService=i,this.router=t,this.sanitizer=n,this.renderer=p,this.el=o,this.pageTitle="",this.id=this.route.snapshot.paramMap.get("participantId"),this.navigationLink="",this.fileType="",this.safeUrl="",this.cachedUserProfile=localStorage.getItem("user_profile"),this.isLoading=!1;let G=this.router.getCurrentNavigation()?.extras.state;G?this.navigationLink=G.data:this.cachedUserProfile&&(JSON.parse(this.cachedUserProfile).role.name==="user"?this.navigationLink=`/participants/${this.id}/profile/personal`:this.navigationLink=`/participants/${this.id}/detail`)}ngOnInit(){let e=this.router.url,t=["sim-a","sim-b","ktp","surat-sehat-buta-warna","surat-bebas-narkoba"].find(n=>e.includes(n));t&&(this.pageTitle=t.toUpperCase().split("-").join(" "),this.id&&this.getFile(this.id,t))}getFile(e,i){this.isLoading=!0,this.participantService.getFile({id:e},i).pipe(ee(t=>(this.fileType=this.getMediaType(t),new Promise((n,p)=>{let o=new FileReader;o.onloadend=()=>n(o.result),o.onerror=p,o.readAsDataURL(t)}))),X(()=>{this.isLoading=!1})).subscribe({next:t=>{this.file=t.split(",")[1],this.fileType==="application/pdf"?this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${this.file}#toolbar=0`):this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${this.file}`)},error:t=>{console.log(t)}})}onImageLoad(){this.isLoading=!1}onImageError(){console.log("Failed to load image:",this.safeUrl),this.isLoading=!1}getMediaType(e){return e.type==="application/pdf"?"application/pdf":e.type==="image/jpeg"?"image/jpeg":e.type==="image/png"?"image/png":e.type==="image/gif"?"image/gif":e.type==="image/bmp"?"image/bmp":e.type==="image/webp"?"image/webp":"application/octet-stream"}getDownloadExtension(){switch(this.fileType){case"image/png":return".png";case"image/jpeg":return".jpeg";case"image/gif":return".gif";case"image/bmp":return".bmp";case"image/webp":return".webp";case"application/pdf":return".pdf";default:return""}}downloadFile(){if(!this.file||!this.fileType){console.error("File content or type is missing, cannot download.");return}let e=`data:${this.fileType};base64,${this.file}`,i=this.renderer.createElement("a");this.renderer.setAttribute(i,"href",e),this.renderer.setAttribute(i,"download",`${(this.pageTitle||"file").replace(/\s+/g,"_")}${this.getDownloadExtension()}`),this.renderer.appendChild(this.el.nativeElement,i),i.click(),this.renderer.removeChild(this.el.nativeElement,i)}static{this.\u0275fac=function(i){return new(i||a)(m(F),m(I),m(N),m(ae),m(Ne),m(ke))}}static{this.\u0275cmp=y({type:a,selectors:[["app-displays-participant-file"]],decls:3,vars:4,consts:[[3,"downloadChange","pageTitle","isLoading","navigationLinks"],[1,"no-files"],["loading","lazy","type","application/pdf",1,"pdf",3,"src"],["loading","lazy",1,"image",3,"src"],["loading","lazy","type","application/pdf",1,"pdf",3,"load","error","src"],["loading","lazy",1,"image",3,"load","error","src"]],template:function(i,t){i&1&&(r(0,"app-display-files",0),g("downloadChange",function(){return t.downloadFile()}),C(1,Ut,2,1)(2,$t,3,0,"div",1),s()),i&2&&(l("pageTitle",t.pageTitle)("isLoading",t.isLoading)("navigationLinks",t.navigationLink),d(),x(t.safeUrl?1:2))},dependencies:[de,T],styles:[".image[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.pdf[_ngcontent-%COMP%]{width:40%;min-height:100vh}.no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}a[_ngcontent-%COMP%]{position:relative;color:#266e99;font-weight:700;font-size:22px}a[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline}a[_ngcontent-%COMP%]:hover{color:purple}"]})}}return a})();var Kt=[{path:"add",component:he,canActivate:[S,M],data:{roles:["super admin","supervisor","lcu"]}},{path:":participantId/detail",component:Q,canActivate:[S,M,O],data:{roles:["super admin","supervisor","lcu"]}},{path:":participantId/profile/personal",component:Q,canActivate:[S,M,O],data:{roles:["user"]}},{path:":participantId/profile/account",component:Q,canActivate:[S,M,O],data:{roles:["user"]}},{path:":participantId/edit",component:ge,canActivate:[S,M],data:{roles:["super admin","lcu","user"]}},{path:":participantId/id-card",component:fe,canActivate:[S,M],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/sim-a",component:R,canActivate:[S,M,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/sim-b",component:R,canActivate:[S,M,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/ktp",component:R,canActivate:[S,M,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/surat-sehat-buta-warna",component:R,canActivate:[S,M,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/surat-bebas-narkoba",component:R,canActivate:[S,M,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"",component:ce,canActivate:[S,M],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"**",redirectTo:"",pathMatch:"full"}],dt=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=ie({type:a})}static{this.\u0275inj=te({imports:[Ce.forChild(Kt),Ce]})}}return a})();var ga=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=ie({type:a})}static{this.\u0275inj=te({imports:[T,E,Qe,dt,ce,he,Q,ge,fe,R]})}}return a})();export{ga as ParticipantModule};
