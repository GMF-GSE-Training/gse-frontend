import{a as Fe,b as xe}from"./chunk-3Q2KUSXG.js";import{a as Ie}from"./chunk-O5IUEWYX.js";import{a as Te}from"./chunk-FFOEILLK.js";import{b as Me}from"./chunk-FBVENKOP.js";import"./chunk-3FGHHD2R.js";import{c as ce,d as he,e as fe,f as Se,g as _e,k as Ce,n as ye,o as N,p as ve,q as we,s as be,t as Ee,u as Pe}from"./chunk-6ITL565O.js";import"./chunk-QKGMZ23H.js";import{a as D}from"./chunk-WUFTDP6O.js";import{a as E,b as P}from"./chunk-W5GHEU6T.js";import{a as O}from"./chunk-G57N2EQR.js";import{A as Q,C as w,g as j,l as me,p as ge,r as y,t as v,u as ue,z as G}from"./chunk-3V2U2C6V.js";import{Cb as oe,Db as se,Eb as le,Fb as pe,G as ee,Gb as C,Ka as re,Kb as I,Lb as x,Mb as R,Na as g,Ob as de,R as te,Ra as ae,S as T,Sa as s,W as ie,Xa as h,Ya as M,a as Y,ab as H,b as Z,ba as u,ca as c,f as J,hb as d,jb as W,ka as z,nb as l,oa as ne,ob as p,pb as S,sb as F,t as X,vb as m,wb as b}from"./chunk-VF5RWILG.js";var A=function(n){return n.SIGNATURE1="SIGNATURE1",n.SIGNATURE2="SIGNATURE2",n}(A||{});var Ne=["form"],U=(()=>{class n{constructor(){this.pageTitle="",this.eSign={},this.isUpdate=!1,this.formSubmit=new z,this.fileChange=new z,this.statusOptions=[{label:"Aktif",value:!0},{label:"Tidak aktif",value:!1}],this.status=!1,this.signatureTypeOptions=[{label:"Tanda tangan 1",value:A.SIGNATURE1},{label:"Tanda tangan 2",value:A.SIGNATURE2}]}onSubmit(){this.form.valid&&this.formSubmit.emit(this.eSign)}onFileChange(t,e){t==="eSign"&&(this.eSign.eSignFileName=e?e.name:null),this.fileChange.emit({property:t,file:e})}onStatusSelected(t){this.eSign.status=t}onSignatureTypeSelected(t){this.eSign.signatureType=t}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=h({type:n,selectors:[["app-e-sign-form"]],viewQuery:function(e,i){if(e&1&&oe(Ne,5),e&2){let r;se(r=le())&&(i.form=r.first)}},inputs:{pageTitle:"pageTitle",eSign:"eSign",isUpdate:"isUpdate"},outputs:{formSubmit:"formSubmit",fileChange:"fileChange"},decls:24,vars:18,consts:[["form","ngForm"],["idNumber","ngModel"],["nik","ngModel"],["name","ngModel"],[1,"container"],[3,"pageTitle"],[3,"ngSubmit"],[1,"form-container"],[1,"left-column"],["name","idNumber","label","No Pegawai","placeholder","No Pegawai","type","text","inputMode","text","required","","autocomplete","username",3,"ngModelChange","ngModel","isRequired"],["name","role","label","Role","placeholder","Role","type","text","inputMode","text","required","","autocomplete","off",3,"ngModelChange","ngModel","isRequired"],["name","name","label","Nama","placeholder","Nama","type","text","inputMode","text","required","","autocomplete","name",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],[1,"right-column"],["idInput","e_sign_input","label","Tanda Tangan","fileType",".png, .jpg, .jpeg",3,"valueChange","isRequired","fileName"],["label","Status","placeholder","--- Pilih capability ---","required","",3,"selectionChange","isRequired","options","initialValue"],["label","Tipe Tanda Tangan","placeholder","--- Pilih tipe tanda tangan ---","required","",3,"selectionChange","isRequired","options","initialValue"],[1,"container-button"],["type","button","routerLink","/e-sign",1,"button"],["type","submit",1,"button",3,"disabled"]],template:function(e,i){if(e&1){let r=F();S(0,"app-header"),l(1,"div",4),S(2,"app-title",5),l(3,"form",6,0),m("ngSubmit",function(){return u(r),c(i.onSubmit())}),l(5,"div",7)(6,"div",8)(7,"app-base-input",9,1),R("ngModelChange",function(o){return u(r),x(i.eSign.idNumber,o)||(i.eSign.idNumber=o),c(o)}),p(),l(9,"app-base-input",10,2),R("ngModelChange",function(o){return u(r),x(i.eSign.role,o)||(i.eSign.role=o),c(o)}),p(),l(11,"app-base-input",11,3),R("ngModelChange",function(o){return u(r),x(i.eSign.name,o)||(i.eSign.name=o),c(o)}),p()(),l(13,"div",12)(14,"app-file-input",13),m("valueChange",function(o){return u(r),c(i.onFileChange("eSign",o))}),p(),l(15,"span"),C(16,"Format png, jpg, atau jpeg."),p(),l(17,"app-dropdown-input",14),m("selectionChange",function(o){return u(r),c(i.onStatusSelected(o))}),p(),l(18,"app-dropdown-input",15),m("selectionChange",function(o){return u(r),c(i.onSignatureTypeSelected(o))}),p()()(),l(19,"div",16)(20,"app-white-button",17),C(21,"Kembali"),p(),l(22,"app-blue-button",18),C(23,"Simpan"),p()()()()}if(e&2){let r=pe(4);g(2),d("pageTitle",i.pageTitle),g(5),I("ngModel",i.eSign.idNumber),d("isRequired",!0),g(2),I("ngModel",i.eSign.role),d("isRequired",!0),g(2),I("ngModel",i.eSign.name),d("isRequired",!0)("restrictToPattern","^[a-zA-Z .-]+$")("pattern","^[a-zA-Z .-]+$"),g(3),d("isRequired",!0)("fileName",i.eSign.eSignFileName),g(3),d("isRequired",!0)("options",i.statusOptions)("initialValue",i.eSign.status),g(),d("isRequired",!0)("options",i.signatureTypeOptions)("initialValue",i.eSign.signatureType),g(4),d("disabled",!i.isUpdate&&(r.invalid||!i.eSign.eSign||i.eSign.status===void 0||!i.eSign.signatureType))}},dependencies:[we,Ee,Fe,Pe,be,j,N,_e,ce,he,Ce,ye,Se,fe,Te,ue,D],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}form[_ngcontent-%COMP%]{background:#fff;padding:2em;border:1px solid #e0e0e0;border-radius:8px;width:100%}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:48%}span[_ngcontent-%COMP%]{margin-left:15px;margin-top:3px;font-size:14px}.error-message[_ngcontent-%COMP%]{color:red}.container-button[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:2em 1em}form[_ngcontent-%COMP%]{padding:1em}.form-container[_ngcontent-%COMP%]{display:block}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:100%}}"]})}}return n})();var f=(()=>{class n{constructor(t){this.http=t,this.apiUrl=Q.apiUrl,this.endpoint=Q.endpoints.eSign}createESign(t){return this.http.post(`${this.apiUrl}/${this.endpoint.base}`,t,{withCredentials:!0})}getESignById(t){return this.http.get(`${this.apiUrl}/${this.endpoint.base}/${t}`,{withCredentials:!0})}updateESign(t,e){return this.http.patch(`${this.apiUrl}/${this.endpoint.base}/${t}`,e,{withCredentials:!0})}getESignFile(t){return this.http.get(`${this.apiUrl}/e-sign/${t}/view`,{withCredentials:!0})}deleteESign(t){return this.http.delete(`${this.apiUrl}/${this.endpoint.base}/${t}`,{withCredentials:!0})}listESign(t,e,i){return this.http.get(`${this.apiUrl}/${this.endpoint.list}?q=${t}&page=${e}&size=${i}`,{withCredentials:!0})}static{this.\u0275fac=function(e){return new(e||n)(ie(me))}}static{this.\u0275prov=te({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var k=(()=>{class n{constructor(t,e,i,r){this.eSignService=t,this.router=e,this.errorHandlerService=i,this.sweetalertService=r,this.eSign={idNumber:"",role:"",name:"",eSign:void 0,eSignFileName:void 0,signatureType:void 0,status:void 0}}onSubmit(t){this.sweetalertService.loading("Mohon tunggu","Proses...");let e=this.prepareFormData(t);this.eSignService.createESign(e).subscribe({next:()=>{this.router.navigateByUrl("/e-sign"),this.sweetalertService.alert("Berhasil","E-Sign berhasil ditambahkan","success")},error:i=>{this.errorHandlerService.alertError(i)}})}onFileChange(t,e){if(e){this.eSign[t]=e;let i=`${t}FileName`;this.eSign[i]=e.name}}prepareFormData(t){let e=new FormData;for(let i in t)if(t.hasOwnProperty(i)){let r=t[i];r instanceof File?e.append(i,r):r!=null&&e.append(i,r.toString())}return e}static{this.\u0275fac=function(e){return new(e||n)(s(f),s(v),s(O),s(w))}}static{this.\u0275cmp=h({type:n,selectors:[["app-add-sign"]],decls:1,vars:1,consts:[["pageTitle","Add E-Sign",3,"fileChange","formSubmit","eSign"]],template:function(e,i){e&1&&(l(0,"app-e-sign-form",0),m("fileChange",function(a){return i.onFileChange(a.property,a.file)})("formSubmit",function(a){return i.onSubmit(a)}),p()),e&2&&d("eSign",i.eSign)},dependencies:[U],styles:[".title-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:10px}.title[_ngcontent-%COMP%]{border-bottom:4px solid #000;font-size:25px}form[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:5px;max-width:90%;margin:auto}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:48%}.container-button[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:90%;margin-top:150px;margin-bottom:15px;margin-left:4em}.button[_ngcontent-%COMP%]{width:190px;height:45px}"]})}}return n})();var De=()=>["super admin"],V=(()=>{class n{constructor(t,e,i,r){this.eSignService=t,this.sweetalertService=e,this.router=i,this.route=r,this.columns=[{header:"No Pegawai",field:"idNumber"},{header:"Role",field:"role"},{header:"Nama",field:"name"},{header:"Tipe Tanda Tangan",field:"signatureType"},{header:"Status",field:"status"},{header:"Tanda Tangan",field:"eSign"},{header:"Action",field:"action"}],this.eSign=[],this.isLoading=!1,this.currentPage=1,this.totalPages=1,this.itemsPerPage=10,this.searchQuery="",this.isLoadingPagination=!1,this.eSignId=this.route.snapshot.paramMap.get("id")}ngOnInit(){this.route.queryParams.subscribe(t=>{this.searchQuery=t.keyword||"",this.currentPage=+t.page||1,this.getListESign(this.searchQuery,this.currentPage,this.itemsPerPage)})}getListESign(t,e,i){this.isLoading=!0,this.isLoadingPagination=!0,this.eSignService.listESign(t,e,i).subscribe({next:({data:r,actions:a})=>{this.eSign=r.map(o=>Z(Y({},o),{signatureType:o.signatureType.replace("SIGNATURE1","Tanda tangan 1").replace("SIGNATURE2","Tanda tangan 2"),status:o.status?"Aktif":"Tidak aktif",eSign:`/e-sign/${o.id}/view`,editLink:a?.canEdit?`/e-sign/${o.id}/edit`:null,deleteMethod:a?.canDelete?()=>this.delteSignature(o):null}))},error:r=>{console.log(r),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}delteSignature(t){return J(this,null,function*(){(yield this.sweetalertService.confirm("Anda Yakin?",`Apakah anda ingin menghapus E-Sign ini : ${t.name}?`,"warning","Ya, hapus!"))&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.eSignService.deleteESign(t.id).subscribe({next:()=>{this.sweetalertService.alert("Dihapus!","Data E-Sign berhasil dihapus","success"),this.eSign=this.eSign.filter(r=>r.id!==t.id),this.eSign.length===0&&this.currentPage>0&&(this.currentPage-=1),this.getListESign(this.searchQuery,this.currentPage,this.itemsPerPage),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages);let i=this.searchQuery?{keyword:this.searchQuery,page:this.currentPage}:{page:this.currentPage};this.router.navigate([],{relativeTo:this.route,queryParams:i,queryParamsHandling:"merge"})},error:i=>{console.log(i),this.sweetalertService.alert("Pemberitahuan","Server sedang sibuk atau terjadi gangguan. Silakan coba beberapa saat lagi.","error")}}))})}onSearchChanged(t){t.trim()===""?this.router.navigate([],{queryParams:{keyword:null,page:null},queryParamsHandling:"merge"}):this.router.navigate([],{queryParams:{keyword:t,page:1},queryParamsHandling:"merge"})}onPageChanged(t){this.router.navigate([],{queryParams:{page:t},queryParamsHandling:"merge"})}viewAll(){this.eSign.length>0,this.router.navigate([],{relativeTo:this.route,queryParams:{keyword:void 0,page:void 0},queryParamsHandling:"merge"}),this.searchQuery=""}static{this.\u0275fac=function(e){return new(e||n)(s(f),s(w),s(v),s(y))}}static{this.\u0275cmp=h({type:n,selectors:[["app-sign-list"]],decls:2,vars:8,consts:[["pageTitle","E-Sign","placeHolder","Cari E-Sign",3,"pageChange","searchChange","viewAllChange","columns","data","isLoading","totalPages","currentPage","blueButtonRoute","roleBassedAccess"]],template:function(e,i){e&1&&(S(0,"app-header"),l(1,"app-data-management",0),m("pageChange",function(a){return i.onPageChanged(a)})("searchChange",function(a){return i.onSearchChanged(a)})("viewAllChange",function(){return i.viewAll()}),p()),e&2&&(g(),d("columns",i.columns)("data",i.eSign)("isLoading",i.isLoading)("totalPages",i.totalPages)("currentPage",i.currentPage)("blueButtonRoute","/e-sign/add")("roleBassedAccess",de(7,De)))},dependencies:[Me,D],encapsulation:2})}}return n})();var q=(()=>{class n{constructor(t,e,i,r,a){this.eSignService=t,this.router=e,this.errorHandlerService=i,this.sweetalertService=r,this.route=a,this.eSign={idNumber:"",role:"",name:"",eSign:void 0,eSignFileName:void 0,signatureType:void 0,status:!1},this.eSignId=this.route.snapshot.paramMap.get("eSignId")}ngOnInit(){this.getESignById()}onUpdate(t){if(this.eSignId){this.sweetalertService.loading("Mohon tunggu","Proses...");let e=this.prepareFormData(t);this.eSignService.updateESign(this.eSignId,e).subscribe({next:()=>{this.router.navigateByUrl("/e-sign"),this.sweetalertService.alert("Berhasil","E-Sign berhasil ditambahkan","success")},error:i=>{this.errorHandlerService.alertError(i)}})}}getESignById(){this.eSignId&&this.eSignService.getESignById(this.eSignId).subscribe({next:({data:t})=>{this.eSign=t,console.log(this.eSign)},error:t=>{console.log(t)}})}onFileChange(t,e){if(e){this.eSign[t]=e;let i=`${t}FileName`;this.eSign[i]=e.name}}prepareFormData(t){let e=new FormData;for(let i in t)if(t.hasOwnProperty(i)){let r=t[i];r==null&&(r=""),r instanceof File,e.append(i,r)}return e}static{this.\u0275fac=function(e){return new(e||n)(s(f),s(v),s(O),s(w),s(y))}}static{this.\u0275cmp=h({type:n,selectors:[["app-edit-sign"]],decls:1,vars:2,consts:[["pageTitle","Edit E-Sign",3,"fileChange","formSubmit","isUpdate","eSign"]],template:function(e,i){e&1&&(l(0,"app-e-sign-form",0),m("fileChange",function(a){return i.onFileChange(a.property,a.file)})("formSubmit",function(a){return i.onUpdate(a)}),p()),e&2&&d("isUpdate",!0)("eSign",i.eSign)},dependencies:[U],styles:[".title-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:10px}.title[_ngcontent-%COMP%]{border-bottom:4px solid #000;font-size:25px}form[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:5px;max-width:90%;margin:auto}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:48%}.container-button[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:90%;margin-top:150px;margin-bottom:15px;margin-left:4em}.button[_ngcontent-%COMP%]{width:190px;height:45px}"]})}}return n})();function Ae(n,B){n&1&&S(0,"app-loader")}function Ue(n,B){if(n&1){let t=F();l(0,"img",3),m("load",function(){u(t);let i=b(2);return c(i.onImageLoad())})("error",function(){u(t);let i=b(2);return c(i.onImageError())}),p()}if(n&2){let t=b(2);d("src",t.safeUrl,re)}}function Le(n,B){n&1&&(l(0,"div",2)(1,"p"),C(2,"File tidak ditemukan!!"),p()())}function ke(n,B){if(n&1&&H(0,Ue,1,1,"img",1)(1,Le,3,0,"div",2),n&2){let t=b();W(t.safeUrl?0:1)}}var $=(()=>{class n{constructor(t,e,i,r,a){this.route=t,this.eSignService=e,this.sanitizer=i,this.renderer=r,this.el=a,this.pageTitle="",this.id=this.route.snapshot.paramMap.get("eSignId"),this.fileType="",this.safeUrl="",this.cachedUserProfile=localStorage.getItem("user_profile"),this.isLoading=!1}ngOnInit(){this.id&&this.getFile(this.id)}getFile(t){this.isLoading=!0,this.eSignService.getESignFile(t).pipe(X(e=>e.data),ee(()=>{this.isLoading=!1})).subscribe({next:e=>{this.file=e,this.fileType=this.getMediaType(e),this.fileType==="application/pdf"?this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${e}#toolbar=0`):this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${e}`)},error:e=>{console.log(e)}})}onImageLoad(){this.isLoading=!1}onImageError(){console.log("Failed to load image:",this.safeUrl),this.isLoading=!1}downloadFile(){let t=`data:${this.fileType};base64,${this.file}`,e=this.renderer.createElement("a");this.renderer.setAttribute(e,"href",t),this.renderer.setAttribute(e,"download",`${this.pageTitle}${this.getDownloadExtension()}`),this.renderer.appendChild(this.el.nativeElement,e),e.click(),this.renderer.removeChild(this.el.nativeElement,e)}getMediaType(t){let e=t.slice(0,10);return e.startsWith("/9j/")?"image/jpeg":e.startsWith("iVBORw0KGg")?"image/png":e.startsWith("JVBER")?"application/pdf":""}getDownloadExtension(){switch(this.fileType){case"image/png":return".png";case"image/jpeg":return".jpeg";case"application/pdf":return".pdf";default:return""}}static{this.\u0275fac=function(e){return new(e||n)(s(y),s(f),s(ge),s(ae),s(ne))}}static{this.\u0275cmp=h({type:n,selectors:[["app-displays-signature-file"]],decls:3,vars:1,consts:[["pageTitle","View E-Sign","navigationLinks","/e-sign",3,"downloadChange"],["loading","lazy",1,"image",3,"src"],[1,"no-files"],["loading","lazy",1,"image",3,"load","error","src"]],template:function(e,i){e&1&&(l(0,"app-display-files",0),m("downloadChange",function(){return i.downloadFile()}),H(1,Ae,1,0,"app-loader")(2,ke,2,1),p()),e&2&&(g(),W(i.isLoading?1:2))},dependencies:[xe,Ie],styles:[".no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}"]})}}return n})();var Ve=[{path:"",component:V,canActivate:[E,P],data:{roles:["super admin","supervisor"]}},{path:"add",component:k,canActivate:[E,P],data:{roles:["super admin"]}},{path:":eSignId/edit",component:q,canActivate:[E,P],data:{roles:["super admin"]}},{path:":eSignId/view",component:$,canActivate:[E,P],data:{roles:["super admin"]}}],je=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=M({type:n})}static{this.\u0275inj=T({imports:[G.forChild(Ve),G]})}}return n})();var At=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=M({type:n})}static{this.\u0275inj=T({imports:[j,N,ve,je,k,V,q,$]})}}return n})();export{At as ESignModule};
