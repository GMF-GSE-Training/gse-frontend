import{a as ht}from"./chunk-CI6FJMVV.js";import{a as O}from"./chunk-GTB7PVDI.js";import{a as he}from"./chunk-5HRMLZSQ.js";import{a as pt,b as st}from"./chunk-RWHKPXA7.js";import{a as ot}from"./chunk-BLXXQZTD.js";import{b as rt}from"./chunk-FLF7QAIU.js";import{a as nt}from"./chunk-ODNHARAG.js";import{a as ue,c as ge,d as it,e as G}from"./chunk-LLJUXWRW.js";import{b as at}from"./chunk-O7UYWYQF.js";import{a as q}from"./chunk-DGMD3CVT.js";import{a as M,b as I}from"./chunk-S5LCZXWF.js";import{a as R}from"./chunk-2RU2G2GG.js";import{a as Me,b as Ke,c as D}from"./chunk-ERSWCUUE.js";import{a as ze,b as He,c as de,d as Qe,e as Ge,f as me,g as Je,h as Ze,i as Ye,j as Xe,k as ce,n as et,o as L,p as tt}from"./chunk-HA77R4EW.js";import{b as We,d as E,e as Ue,g as S,l as $e,p as le,r as x,t as B,u as Q,z as Se}from"./chunk-PTR267HX.js";import{Ab as qe,Cb as V,Db as W,Eb as U,Fb as Ae,G as ie,Gb as m,Hb as se,Ib as je,Ja as Oe,Ka as X,Kb as v,La as Ee,Lb as P,M as ae,Mb as w,Na as l,Nb as Ve,Ob as ee,Pb as $,Q as Ne,R as xe,Ra as Le,S as ne,Sa as c,W as Be,Xa as y,Ya as re,a as z,ab as h,b as H,ba as u,ca as g,e as gt,f as Te,hb as s,ib as Re,jb as F,ka as j,nb as r,o as ke,oa as De,ob as o,pb as b,sb as N,t as Fe,vb as _,wb as f,xb as oe,yb as pe}from"./chunk-NHTCOLVS.js";var k=(()=>{class a{constructor(e){this.http=e,this.apiUrl=Me.apiUrl,this.endpoints=Me.endpoints.participant}createParticipant(e){return this.http.post(`${this.apiUrl}/${this.endpoints.base}`,e,{withCredentials:!0})}getParticipantById(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}`,{withCredentials:!0})}updateParticipant(e,i){return this.http.patch(`${this.apiUrl}/${this.endpoints.base}/${e}`,i,{withCredentials:!0})}deleteParticipant(e){return this.http.delete(`${this.apiUrl}/${this.endpoints.base}/${e}`,{withCredentials:!0})}listParticipants(e,i,t){return this.http.get(`${this.apiUrl}/${this.endpoints.list}?q=${e}&page=${i}&size=${t}`,{withCredentials:!0})}getFile({id:e},i){return this.http.get(`${this.apiUrl}/participants/${e}/${i}`,{responseType:"blob",withCredentials:!0})}getFoto(e){return this.http.get(`${this.apiUrl}/participants/${e}/foto`,{responseType:"blob",withCredentials:!0})}getQrCode(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}/qr-code`,{responseType:"blob",withCredentials:!0})}downloadIdCard(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}/${this.endpoints.downloadIdCard}`,{withCredentials:!0,responseType:"blob"})}downloadDocument(e){return this.http.get(`${this.apiUrl}/${e}/download-id-card`,{withCredentials:!0,responseType:"blob"})}viewIdCard(e){return this.http.get(`${this.apiUrl}/${this.endpoints.base}/${e}/${this.endpoints.idCard}`,{responseType:"text",withCredentials:!0})}isDataComplete(e){return this.http.get(`${this.apiUrl}/${this.endpoints.isComplete}/${e}`,{withCredentials:!0})}downloadAllFiles(e){return this.http.get(`${this.apiUrl}/participants/${e}/download-all`,{withCredentials:!0,responseType:"blob"})}static{this.\u0275fac=function(i){return new(i||a)(Be($e))}}static{this.\u0275prov=xe({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var Ce=(()=>{class a{constructor(e,i,t,n){this.participantService=e,this.sweetalertService=i,this.router=t,this.route=n,this.pageTitle="Participants",this.columns=[{header:"No Pegawai",field:"idNumber"},{header:"Nama",field:"name"},{header:"Dinas",field:"dinas"},{header:"Bidang",field:"bidang"},{header:"Perusahaan",field:"company"},{header:"Email",field:"email"},{header:"Action",field:"action"}],this.participants=[],this.isLoading=!1,this.currentPage=1,this.totalPages=1,this.itemsPerPage=10,this.searchQuery="",this.placeHolder="Cari Participant",this.roleBassedAccess=["super admin","supervisor","lcu"]}ngOnInit(){this.route.queryParams.subscribe(e=>{this.searchQuery=e.keyword||"",this.currentPage=+e.page||1,this.getListParticipants(this.searchQuery,this.currentPage,this.itemsPerPage)})}getListParticipants(e,i,t){this.isLoading=!0,this.participantService.listParticipants(e,i,t).subscribe({next:n=>{this.participants=this.mapParticipants(n),this.totalPages=n.paging?.totalPage??1},error:n=>{console.log(n),this.sweetalertService.alert("Pemberitahuan","Server sedang sibuk atau terjadi gangguan. Silakan coba beberapa saat lagi.","error"),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}deleteParticipant(e){return Te(this,null,function*(){(yield this.sweetalertService.confirm("Anda Yakin?",`Apakah anda ingin menghapus peserta ini : ${e.name}?`,"warning","Ya, hapus!"))&&(this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.deleteParticipant(e.id).subscribe({next:()=>{this.sweetalertService.alert("Dihapus!","Data peserta berhasil dihapus","success"),this.participants=this.participants.filter(n=>n.id!==e.id),this.participants.length===0&&this.currentPage>0&&(this.currentPage-=1),this.getListParticipants(this.searchQuery,this.currentPage,this.itemsPerPage),this.currentPage>this.totalPages&&(this.currentPage=this.totalPages);let t=this.searchQuery?{keyword:this.searchQuery,page:this.currentPage}:{page:this.currentPage};this.router.navigate([],{relativeTo:this.route,queryParams:t,queryParamsHandling:"merge"})},error:t=>{console.log(t),this.sweetalertService.alert("Gagal!","Terjadi kesalahan, coba lagi nanti","error")}}))})}onSearchChanged(e){e.trim()===""?this.router.navigate([],{queryParams:{keyword:null,page:null},queryParamsHandling:"merge"}):this.router.navigate([],{queryParams:{keyword:e,page:1},queryParamsHandling:"merge"})}onPageChanged(e){this.router.navigate([],{queryParams:{page:e},queryParamsHandling:"merge"})}viewAll(){this.participants.length>0,this.router.navigate([],{relativeTo:this.route,queryParams:{keyword:void 0,page:void 0},queryParamsHandling:"merge"}),this.searchQuery=""}mapParticipants(e){return e.data.map(i=>H(z({},i),{idNumber:i.idNumber??"-",dinas:i.dinas??"-",bidang:i.bidang??"-",company:i.company??"-",editLink:e.actions?.canEdit?`/participants/${i.id}/edit`:null,detailLink:e.actions?.canView?`/participants/${i.id}/detail`:null,deleteMethod:e.actions?.canDelete?()=>this.deleteParticipant(i):null}))}static{this.\u0275fac=function(i){return new(i||a)(c(k),c(D),c(B),c(x))}}static{this.\u0275cmp=y({type:a,selectors:[["app-participant-list"]],decls:2,vars:9,consts:[[3,"pageChange","searchChange","viewAllChange","pageTitle","columns","data","isLoading","totalPages","currentPage","placeHolder","blueButtonRoute","roleBassedAccess"]],template:function(i,t){i&1&&(b(0,"app-header"),r(1,"app-data-management",0),_("pageChange",function(d){return t.onPageChanged(d)})("searchChange",function(d){return t.onSearchChanged(d)})("viewAllChange",function(){return t.viewAll()}),o()),i&2&&(l(),s("pageTitle",t.pageTitle)("columns",t.columns)("data",t.participants)("isLoading",t.isLoading)("totalPages",t.totalPages)("currentPage",t.currentPage)("placeHolder",t.placeHolder)("blueButtonRoute","/participants/add")("roleBassedAccess",t.roleBassedAccess))},dependencies:[rt,q],encapsulation:2})}}return a})();var Ct=["*"];function _t(a,C){a&1&&(r(0,"span"),m(1,"*"),o())}function yt(a,C){if(a&1){let e=N();r(0,"input",7),w("ngModelChange",function(t){u(e);let n=f();return P(n.companyName,t)||(n.companyName=t),g(t)}),o()}if(a&2){let e=f();s("name",e.name)("required",e.showCompanyInput),v("ngModel",e.companyName)}}var K=(()=>{class a{constructor(){this.selectedCompany="",this.showCompanyInput=!1,this.companyName="",this.name="",this.isRequired=!1}ngOnInit(){this.selectedCompany||(this.selectedCompany="GMF",this.toggleCompanyInput())}toggleCompanyInput(){this.showCompanyInput=this.selectedCompany==="Non GMF"}getCompanyName(){return this.selectedCompany==="Non GMF"?this.companyName:"GMF"}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-company-input"]],inputs:{selectedCompany:"selectedCompany",showCompanyInput:"showCompanyInput",companyName:"companyName",name:"name",isRequired:"isRequired"},ngContentSelectors:Ct,decls:11,vars:3,consts:[[1,"container"],["for","company-select"],[4,"ngIf"],["id","company-select",3,"ngModelChange","change","ngModel"],["value","GMF"],["value","Non GMF"],["type","text","id","company-input","placeholder","Nama Perusahaan",3,"name","required","ngModel","ngModelChange",4,"ngIf"],["type","text","id","company-input","placeholder","Nama Perusahaan",3,"ngModelChange","name","required","ngModel"]],template:function(i,t){i&1&&(oe(),r(0,"div",0)(1,"label",1),m(2,"Perusahaan "),h(3,_t,2,0,"span",2),o(),r(4,"select",3),w("ngModelChange",function(d){return P(t.selectedCompany,d)||(t.selectedCompany=d),d}),_("change",function(){return t.toggleCompanyInput()}),r(5,"option",4),m(6,"GMF"),o(),r(7,"option",5),m(8,"Non GMF"),o()(),h(9,yt,1,3,"input",6),pe(10),o()),i&2&&(l(3),s("ngIf",t.isRequired),l(),v("ngModel",t.selectedCompany),l(5),s("ngIf",t.showCompanyInput))},dependencies:[L,Ye,Xe,He,Ze,de,ce,me,S,E],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{display:flex;margin-top:15px;font-weight:700;font-size:1em}select[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:25px;overflow:hidden;width:100%;margin-top:5px;border:3px solid #ccc;height:40px;font-weight:700;padding-left:8px;font-size:15px}span[_ngcontent-%COMP%]{color:red}@media (max-width: 768px){input[_ngcontent-%COMP%]{border:2px solid #ccc}}"]})}}return a})();function bt(a,C){a&1&&(r(0,"span"),m(1,"*"),o())}var lt=(()=>{class a{constructor(){this.label="",this.placeholder="Maksimal 2 MB",this.fileName=null,this.fileType="",this.required=!1,this.isRequired=!1,this.valueChange=new j,this.isFileSelected=!0}get displayFileName(){return this.fileName||this.placeholder}onFileSelected(e){let i=e.target;i&&i.files&&i.files.length>0?(this.fileName=i.files[0].name,this.isFileSelected=!0,this.valueChange.emit(i.files[0])):(this.fileName=null,this.isFileSelected=!1,this.valueChange.emit(null))}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-file-input"]],inputs:{label:"label",idInput:"idInput",placeholder:"placeholder",fileName:"fileName",fileType:"fileType",required:"required",isRequired:"isRequired"},outputs:{valueChange:"valueChange"},features:[Ve([{provide:ze,useExisting:Ne(()=>a),multi:!0}])],decls:9,vars:8,consts:[[3,"for"],[4,"ngIf"],[1,"file-upload"],[1,"file-upload-label",3,"for"],[1,"file-upload-text"],["type","file","hidden","",3,"change","id","accept","required"]],template:function(i,t){i&1&&(r(0,"label",0),m(1),h(2,bt,2,0,"span",1),o(),r(3,"div",2)(4,"label",3),m(5,"Pilih File"),o(),r(6,"div",4),m(7),o(),r(8,"input",5),_("change",function(d){return t.onFileSelected(d)}),o()()),i&2&&(s("for",t.idInput),l(),je(" ",t.label," "),l(),s("ngIf",t.isRequired),l(2),s("for",t.idInput),l(3),se(t.displayFileName),l(),s("id",t.idInput)("accept",t.fileType)("required",t.required))},dependencies:[S,E],styles:[".file-upload[_ngcontent-%COMP%]{display:flex;align-items:center;border-radius:25px;overflow:hidden;width:100%;border:3px solid #ccc}.file-upload-label[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:#424352;padding:10px 20px;cursor:pointer;color:#fff;font-size:15px;border-radius:25px;width:auto;margin:0;height:100%}.file-upload-text[_ngcontent-%COMP%]{padding-left:1em;color:#000;flex-grow:1;overflow-x:auto}label[_ngcontent-%COMP%]{display:flex;margin-top:15px;font-weight:700;font-size:1em}.error-message[_ngcontent-%COMP%], span[_ngcontent-%COMP%]{color:red}"]})}}return a})();var vt=["form"];function Pt(a,C){a&1&&(r(0,"span",39),m(1,"SIM A wajib diunggah"),o())}function wt(a,C){a&1&&(r(0,"span",39),m(1,"KTP wajib diunggah"),o())}function St(a,C){a&1&&(r(0,"span",39),m(1,"Pas Foto wajib diunggah"),o())}function Mt(a,C){a&1&&(r(0,"span",39),m(1,"Surat Ket. Sehat dan Buta Warna wajib diunggah"),o())}function It(a,C){a&1&&(r(0,"span",39),m(1,"Surat Ket. Bebas Narkoba wajib diunggah"),o())}var ye=(()=>{class a{constructor(){this.pageTitle="",this.participant={},this.isUpdate=!1,this.fileType=".png, .jpg, .jpeg, .pdf",this.fileTypeFoto=".png, .jpg, .jpeg",this.formSubmit=new j,this.fileChange=new j,this.selectedCompany="",this.companyName="",this.showCompanyInput=!1,this.backButtonRoute="/participants",this.cachedUserProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.currentUserRole=this.cachedUserProfile.role?.name}ngOnInit(){this.currentUserRole=this.cachedUserProfile.role?.name}onSubmit(){this.form.valid&&(this.participant.company=this.companyInputComponent.getCompanyName(),this.isUpdate?(this.cachedUserProfile&&this.currentUserRole!=="super admin"&&delete this.participant.email,this.formSubmit.emit(this.participant)):this.formSubmit.emit(this.participant))}onFileChange(e,i){e==="simA"&&(this.participant.simAFileName=i?i.name:null),this.fileChange.emit({property:e,file:i})}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-participant-form"]],viewQuery:function(i,t){if(i&1&&(V(K,5),V(vt,5)),i&2){let n;W(n=U())&&(t.companyInputComponent=n.first),W(n=U())&&(t.form=n.first)}},inputs:{pageTitle:"pageTitle",participant:"participant",isUpdate:"isUpdate",selectedCompany:"selectedCompany",companyName:"companyName",showCompanyInput:"showCompanyInput",backButtonRoute:"backButtonRoute"},outputs:{formSubmit:"formSubmit",fileChange:"fileChange"},decls:58,vars:57,consts:[["form","ngForm"],["name","ngModel"],["nik","ngModel"],["email","ngModel"],["phoneNumber","ngModel"],["nationality","ngModel"],["placeOfBirth","ngModel"],["dateOfBirth","ngModel"],["tglKeluarSuratSehatButaWarna","ngModel"],["tglKeluarSuratBebasNarkoba","ngModel"],[1,"container"],[3,"pageTitle"],[3,"ngSubmit"],[1,"form-container"],[1,"left-column"],["name","idNumber","label","No Pegawai","placeholder","No Pegawai","type","text","autocomplete","on","inputMode","tel",3,"ngModelChange","ngModel"],["name","name","label","Nama","placeholder","Masukkan nama asli, nama akan digunakan pada data sertifikat","type","text","autocomplete","name","inputMode","text","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],["name","nik","label","NIK/Paspor","placeholder","Masukkan NIK/Paspor","type","text","autocomplete","off","inputMode","text","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern","pattern"],["name","dinas","label","Dinas","placeholder","Dinas","type","text","autocomplete","off","inputMode","text",3,"ngModelChange","ngModel"],["name","bidang","label","Bidang","placeholder","Bidang","type","text","autocomplete","off","inputMode","text",3,"ngModelChange","ngModel"],[3,"selectedCompany","companyName","showCompanyInput","isRequired"],["name","email","label","Email","placeholder","Gunakan email aktif","type","email","autocomplete","email","inputMode","text",3,"ngModelChange","ngModel","isRequired","disabled"],["name","phoneNumber","label","Nomor Telepon","placeholder","Gunakan nomor telepon aktif","type","tel","autocomplete","tel","inputMode","tel","pattern","^[0-9+\\- ]+$","required","",3,"ngModelChange","ngModel","isRequired","restrictToPattern"],["name","nationality","label","Kewarganegaraan","placeholder","Isi kewarganegaraan sesuai KTP/Paspor","type","text","autocomplete","country-name","inputMode","text",3,"ngModelChange","ngModel","isRequired"],["name","placeOfBirth","label","Tempat Lahir","placeholder","Isi Tempat Lahir sesuai KTP/Paspor","type","text","autocomplete","address-level2","inputMode","text",3,"ngModelChange","ngModel","isRequired"],[1,"right-column"],["name","dateOfBirth","label","Tanggal Lahir","type","date","inputmode","date","defaultMessage","Isi Tanggal Lahir sesuai KTP/Paspor",3,"ngModelChange","ngModel","isRequired"],["idInput","sim_a_input","label","SIM A",3,"valueChange","isRequired","fileName","fileType","required"],["class","error-message",4,"ngIf"],["idInput","sim_b_input","label","SIM B",3,"valueChange","fileName","fileType"],["idInput","ktp_input","label","KTP/Paspor",3,"valueChange","isRequired","fileName","fileType"],["idInput","foto_input","label","Pas Foto",3,"valueChange","isRequired","fileName","fileType"],["idInput","surat_sehat_input","label","Surat Ket. Sehat dan Buta Warna",3,"valueChange","isRequired","fileName","fileType"],["name","tglKeluarSuratSehatButaWarna","label","Tanggal Pembuatan Surat Ket. Sehat & Buta Warna","defaultMessage","Masukkan tanggal keluar surat sehat sesuai dengan tanggal keluar surat yang diunggah","type","date","inputmode","date","required","",3,"ngModelChange","ngModel","isRequired"],["idInput","surat_bebas_narkoba_input","label","Surat Ket. Bebas Narkoba",3,"valueChange","isRequired","fileName","fileType"],["name","tglKeluarSuratBebasNarkoba","label","Tanggal Pembuatan Surat Ket. Bebas Narkoba","defaultMessage","Masukkan tanggal keluar surat sehat sesuai dengan tanggal keluar surat yang diunggah","type","date","inputmode","date","required","",3,"ngModelChange","ngModel","isRequired"],[1,"buttons-container"],["type","button",1,"button",3,"routerLink"],["type","submit",1,"button",3,"disabled"],[1,"error-message"]],template:function(i,t){if(i&1){let n=N();b(0,"app-header"),r(1,"div",10),b(2,"app-title",11),r(3,"form",12,0),_("ngSubmit",function(){return u(n),g(t.onSubmit())}),r(5,"div",13)(6,"div",14)(7,"app-base-input",15),w("ngModelChange",function(p){return u(n),P(t.participant.idNumber,p)||(t.participant.idNumber=p),g(p)}),o(),r(8,"app-base-input",16,1),w("ngModelChange",function(p){return u(n),P(t.participant.name,p)||(t.participant.name=p),g(p)}),o(),r(10,"app-base-input",17,2),w("ngModelChange",function(p){return u(n),P(t.participant.nik,p)||(t.participant.nik=p),g(p)}),o(),r(12,"app-base-input",18),w("ngModelChange",function(p){return u(n),P(t.participant.dinas,p)||(t.participant.dinas=p),g(p)}),o(),r(13,"app-base-input",19),w("ngModelChange",function(p){return u(n),P(t.participant.bidang,p)||(t.participant.bidang=p),g(p)}),o(),b(14,"app-company-input",20),r(15,"app-base-input",21,3),w("ngModelChange",function(p){return u(n),P(t.participant.email,p)||(t.participant.email=p),g(p)}),o(),r(17,"app-base-input",22,4),w("ngModelChange",function(p){return u(n),P(t.participant.phoneNumber,p)||(t.participant.phoneNumber=p),g(p)}),o(),r(19,"app-base-input",23,5),w("ngModelChange",function(p){return u(n),P(t.participant.nationality,p)||(t.participant.nationality=p),g(p)}),o(),r(21,"app-base-input",24,6),w("ngModelChange",function(p){return u(n),P(t.participant.placeOfBirth,p)||(t.participant.placeOfBirth=p),g(p)}),o()(),r(23,"div",25)(24,"app-base-input",26,7),w("ngModelChange",function(p){return u(n),P(t.participant.dateOfBirth,p)||(t.participant.dateOfBirth=p),g(p)}),o(),r(26,"app-file-input",27),_("valueChange",function(p){return u(n),g(t.onFileChange("simA",p))}),o(),h(27,Pt,2,0,"span",28),r(28,"span"),m(29,"Format png, jpg, jpeg, atau pdf."),o(),r(30,"app-file-input",29),_("valueChange",function(p){return u(n),g(t.onFileChange("simB",p))}),o(),r(31,"span"),m(32,"Format png, jpg, jpeg, atau pdf."),o(),r(33,"app-file-input",30),_("valueChange",function(p){return u(n),g(t.onFileChange("ktp",p))}),o(),h(34,wt,2,0,"span",28),r(35,"span"),m(36,"Format png, jpg, jpeg, atau pdf."),o(),r(37,"app-file-input",31),_("valueChange",function(p){return u(n),g(t.onFileChange("foto",p))}),o(),h(38,St,2,0,"span",28),r(39,"span"),m(40,"Format png, jpg, atau jpeg. ukuran 3x4."),o(),r(41,"app-file-input",32),_("valueChange",function(p){return u(n),g(t.onFileChange("suratSehatButaWarna",p))}),o(),h(42,Mt,2,0,"span",28),r(43,"span"),m(44,"Format png, jpg, jpeg, atau pdf."),o(),r(45,"app-base-input",33,8),w("ngModelChange",function(p){return u(n),P(t.participant.tglKeluarSuratSehatButaWarna,p)||(t.participant.tglKeluarSuratSehatButaWarna=p),g(p)}),o(),r(47,"app-file-input",34),_("valueChange",function(p){return u(n),g(t.onFileChange("suratBebasNarkoba",p))}),o(),h(48,It,2,0,"span",28),r(49,"span"),m(50,"Format png, jpg, jpeg, atau pdf."),o(),r(51,"app-base-input",35,9),w("ngModelChange",function(p){return u(n),P(t.participant.tglKeluarSuratBebasNarkoba,p)||(t.participant.tglKeluarSuratBebasNarkoba=p),g(p)}),o()()(),r(53,"div",36)(54,"app-white-button",37),m(55,"Kembali"),o(),r(56,"app-blue-button",38),m(57," Simpan "),o()()()()}if(i&2){let n=Ae(4);l(2),s("pageTitle",t.pageTitle),l(5),v("ngModel",t.participant.idNumber),l(),v("ngModel",t.participant.name),s("isRequired",!0)("restrictToPattern","^[a-zA-Z ]+$")("pattern","^[a-zA-Z ]+$"),l(2),v("ngModel",t.participant.nik),s("isRequired",!0)("restrictToPattern","^[0-9]+$")("pattern","^[0-9]+$"),l(2),v("ngModel",t.participant.dinas),l(),v("ngModel",t.participant.bidang),l(),s("selectedCompany",t.selectedCompany)("companyName",t.companyName)("showCompanyInput",t.showCompanyInput)("isRequired",!0),l(),v("ngModel",t.participant.email),s("isRequired",!0)("disabled",t.isUpdate&&(!t.currentUserRole||t.currentUserRole!=="super admin")),l(2),v("ngModel",t.participant.phoneNumber),s("isRequired",!0)("restrictToPattern","^[0-9-+ ]+$"),l(2),v("ngModel",t.participant.nationality),s("isRequired",!0),l(2),v("ngModel",t.participant.placeOfBirth),s("isRequired",!0),l(3),v("ngModel",t.participant.dateOfBirth),s("isRequired",!0),l(2),s("isRequired",!0)("fileName",t.participant.simAFileName)("fileType",t.fileType)("required",t.participant.simAFileName),l(),s("ngIf",!t.participant.simAFileName&&n.submitted),l(3),s("fileName",t.participant.simBFileName)("fileType",t.fileType),l(3),s("isRequired",!0)("fileName",t.participant.ktpFileName)("fileType",t.fileType),l(),s("ngIf",!t.participant.ktpFileName&&n.submitted),l(3),s("isRequired",!0)("fileName",t.participant.fotoFileName)("fileType",t.fileTypeFoto),l(),s("ngIf",!t.participant.fotoFileName&&n.submitted),l(3),s("isRequired",!0)("fileName",t.participant.suratSehatButaWarnaFileName)("fileType",t.fileType),l(),s("ngIf",!t.participant.suratSehatButaWarnaFileName&&n.submitted),l(3),v("ngModel",t.participant.tglKeluarSuratSehatButaWarna),s("isRequired",!0),l(2),s("isRequired",!0)("fileName",t.participant.suratBebasNarkobaFileName)("fileType",t.fileType),l(),s("ngIf",!t.participant.suratBebasNarkobaFileName&&n.submitted),l(3),v("ngModel",t.participant.tglKeluarSuratBebasNarkoba),s("isRequired",!0),l(3),s("routerLink",t.backButtonRoute),l(2),s("disabled",n.invalid||!t.participant.simA||!t.participant.ktp||!t.participant.foto||!t.participant.suratSehatButaWarna||!t.participant.suratBebasNarkoba)}},dependencies:[lt,K,G,ge,it,Q,L,Je,de,Qe,ce,et,me,Ge,ue,S,E,q],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}form[_ngcontent-%COMP%]{background:#fff;padding:2em;border:1px solid #e0e0e0;border-radius:8px;max-width:100%}.form-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:48%}span[_ngcontent-%COMP%]{margin-left:15px;margin-top:3px;font-size:14px}.error-message[_ngcontent-%COMP%]{color:red}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:2em 1em}form[_ngcontent-%COMP%]{padding:1em}.form-container[_ngcontent-%COMP%]{display:block}.left-column[_ngcontent-%COMP%], .right-column[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();var be=(()=>{class a{constructor(e,i,t,n){this.router=e,this.participantService=i,this.sweetalertService=t,this.errorHandlerService=n,this.createParticipant={idNumber:"",name:"",nik:"",dinas:"",bidang:"",company:"",email:"",phoneNumber:"",nationality:"",placeOfBirth:"",dateOfBirth:"",simA:null,simAFileName:"",simB:null,simBFileName:"",ktp:null,ktpFileName:"",foto:null,fotoFileName:"",suratSehatButaWarna:null,suratSehatButaWarnaFileName:"",suratBebasNarkoba:null,suratBebasNarkobaFileName:"",tglKeluarSuratSehatButaWarna:"",tglKeluarSuratBebasNarkoba:""},this.requiredFields=["name","company","email","phoneNumber","kewarganegaraan","placeOfBirth","dateOfBirth","simA","ktp","foto","suratSehatButaWarna","tglKeluarSuratSehatButaWarna","suratBebasNarkoba","tglKeluarSuratSehatBebasNarkoba"]}onCreate(e){let i=this.prepareFormData(e);this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.createParticipant(i).subscribe({next:t=>{let n=t.data;this.sweetalertService.alert("Ditambahkan!","Peserta berhasil ditambahkan","success"),this.router.navigateByUrl("/users/add",{state:{id:n.id,idNumber:n.idNumber,nik:n.nik,email:n.email,name:n.name,dinas:n.dinas}})},error:t=>{this.errorHandlerService.alertError(t,this.requiredFields)}})}onFileChange(e,i){if(i){this.createParticipant[e]=i;let t=`${e}FileName`;this.createParticipant[t]=i.name}}prepareFormData(e){let i=new FormData;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];n==null&&(n=""),(n instanceof File||n)&&i.append(t,n)}return i}static{this.\u0275fac=function(i){return new(i||a)(c(B),c(k),c(D),c(R))}}static{this.\u0275cmp=y({type:a,selectors:[["app-add-participant-data"]],viewQuery:function(i,t){if(i&1&&V(K,5),i&2){let n;W(n=U())&&(t.companyInputComponent=n.first)}},decls:1,vars:2,consts:[[3,"formSubmit","fileChange","pageTitle","participant"]],template:function(i,t){i&1&&(r(0,"app-participant-form",0),_("formSubmit",function(d){return t.onCreate(d)})("fileChange",function(d){return t.onFileChange(d.property,d.file)}),o()),i&2&&s("pageTitle","Add Participant Data")("participant",t.createParticipant)},dependencies:[L,ye],encapsulation:2})}}return a})();var Tt=()=>["super admin","supervisor","lcu"],kt=()=>["user"],Ft=()=>["super admin","lcu","supervisor"],Nt=()=>["super admin","lcu","user"],dt=a=>({active:a}),xt=a=>["/participants",a,"profile","personal"],Bt=a=>["/participants",a,"profile","account"];function Dt(a,C){a&1&&b(0,"app-loader")}function Ot(a,C){a&1&&(r(0,"div",21),m(1,"Data peserta tidak ditemukan."),o())}function Et(a,C){if(a&1&&b(0,"img",5),a&2){let e=f(2);qe("src","data:",e.photoType,"/;base64,",e.pasFoto,"",X)}}function Lt(a,C){if(a&1&&(r(0,"span",22)(1,"span"),m(2,"Cetak Kartu Peserta"),o()()),a&2){let e=f(2);s("routerLink",e.idCardLink)}}function Rt(a,C){if(a&1&&(r(0,"div",23)(1,"div",24),b(2,"i",25),r(3,"span"),m(4,"Data Pribadi"),o()(),r(5,"div",24),b(6,"i",26),r(7,"span"),m(8,"Akun"),o()()()),a&2){let e=f(2);l(),s("ngClass",$(4,dt,e.selectedItem===0))("routerLink",$(6,xt,e.id)),l(4),s("ngClass",$(8,dt,e.selectedItem===1))("routerLink",$(10,Bt,e.id))}}function qt(a,C){if(a&1){let e=N();r(0,"app-vertical-table",27),_("downloadDocumentClick",function(){u(e);let t=f(2);return g(t.downloadDocument())}),o()}if(a&2){let e=f(2);s("isParticipantDetail",!0)("data",e.verticalTableData)}}function At(a,C){if(a&1){let e=N();r(0,"div",16)(1,"div",28)(2,"app-email-form-card",29),_("formSubmit",function(t){u(e);let n=f(2);return g(n.updateEmailSubmit(t))}),o()(),r(3,"div",28)(4,"app-password-update-form-card",30),_("formSubmit",function(t){u(e);let n=f(2);return g(n.updatePasswordSubmit(t))}),o()()()}}function jt(a,C){if(a&1&&(r(0,"app-white-button",31),m(1,"Kembali"),o()),a&2){let e=f(2);s("routerLink",e.backButtonRoute||"/participants")}}function Vt(a,C){if(a&1&&(r(0,"app-blue-button",31),m(1,"Edit"),o()),a&2){let e=f(2);s("routerLink",e.editLink)}}function Wt(a,C){if(a&1&&(h(0,Ot,2,0,"div",1),r(1,"div",2)(2,"div",3)(3,"div",4),h(4,Et,1,3,"img",5),o(),r(5,"div",6)(6,"h2"),m(7),o()()(),r(8,"div",7)(9,"div",8),b(10,"img",9),o(),r(11,"div",10),h(12,Lt,3,1,"span",11),o()()(),r(13,"div",12),h(14,Rt,9,12,"div",13),r(15,"div",14),h(16,qt,1,2,"app-vertical-table",15)(17,At,5,0,"div",16),o()(),r(18,"div",17),b(19,"app-table",18),o(),r(20,"div",19),h(21,jt,2,1,"app-white-button",20)(22,Vt,2,1,"app-blue-button",20),o()),a&2){let e=f();s("ngIf",!e.participant&&!e.isLoading),l(4),F(e.pasFoto?4:-1),l(3),se(e.participant==null?null:e.participant.name),l(3),s("src",e.qrCode,X),l(2),s("appRoleBasedAccess",ee(11,Tt)),l(2),s("appRoleBasedAccess",ee(12,kt)),l(2),F(e.selectedItem===0?16:e.selectedItem===1?17:-1),l(3),s("columns",e.columns)("data",e.data),l(2),s("appRoleBasedAccess",ee(13,Ft)),l(),s("appRoleBasedAccess",ee(14,Nt))}}var Z=(()=>{class a{constructor(e,i,t,n,d,p){this.route=e,this.router=i,this.participantService=t,this.authService=n,this.sweetalertService=d,this.errorHandlerService=p,this.participant=null,this.verticalTableData=[],this.editLink="",this.photoType=null,this.backButtonRoute="/participants",this.selectedItem=0,this.isLoading=!1,this.pasFoto=localStorage.getItem("pas_foto"),this.qrCode=localStorage.getItem("qr_code"),this.qrCodeDownloadName="QR_Code.png",this.id=this.route.snapshot.paramMap.get("participantId")||JSON.parse(localStorage.getItem("user_profile")||"{}").participant.id,this.idCardLink="",this.dateOptions={day:"numeric",month:"long",year:"numeric"},this.columns=[{header:"Kompetensi",field:"trainingName"},{header:"Exp Sertifikat",field:"exp"}],this.data=[{trainingName:"Forklift",exp:"10 February 2026"},{trainingName:"Regulasi GSE",exp:"10 February 2026"},{trainingName:"Baggage Towing Tractor",exp:"10 February 2026"},{trainingName:"Air Conditioning System Refreshment",exp:"10 February 2026"}],this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.updateEmail={email:""};let Y=this.router.getCurrentNavigation()?.extras.state;Y&&(this.backButtonRoute=Y.data)}ngOnInit(){this.route.queryParams.subscribe(e=>{e.error?(this.sweetalertService.alert("Gagal",e.error,"error"),this.router.navigate([],{relativeTo:this.route,queryParams:{error:null},queryParamsHandling:"merge"})):e.success&&(this.sweetalertService.alert("Sukses",e.success,"success"),this.getParticipantById(),this.router.navigate([],{relativeTo:this.route,queryParams:{success:null},queryParamsHandling:"merge"}))}),this.route.url.subscribe(e=>{let i=e.map(t=>t.path).join("/");this.selectedItem=i===`participants/${this.id}/profile/personal`?0:i===`participants/${this.id}/profile/account`?1:0}),this.userProfile.role.name==="user"?this.id!==this.userProfile.participant.id?this.getParticipantById():this.getParticipantFromLocalStorage():this.getParticipantById()}getParticipantFromLocalStorage(){this.isLoading=!0,this.participant=this.userProfile.participant,this.participant&&this.setParticipantData(this.participant),this.isLoading=!1}getParticipantById(){this.isLoading=!0,this.participantService.getParticipantById(this.id).subscribe({next:e=>{e.data?this.setParticipantData(e.data):this.participant=null},error:e=>{console.error(e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}getFoto(e){this.participantService.getFoto(e).pipe(Fe(i=>new Promise((t,n)=>{let d=new FileReader;d.onloadend=()=>t(d.result),d.onerror=n,d.readAsDataURL(i)})),ae(i=>ke(i))).subscribe({next:i=>{this.photoType=this.getMediaType(i),this.pasFoto=i.split(",")[1],this.userProfile.role.name==="user"&&localStorage.setItem("pas_foto",this.pasFoto)},error:i=>console.error("Error fetching photo:",i)})}getQrCode(e){this.participantService.getQrCode(e).subscribe({next:i=>{let t=new FileReader;t.onloadend=()=>{this.qrCode=t.result,this.userProfile.role.name==="user"&&localStorage.setItem("qr_code",this.qrCode)},t.readAsDataURL(i)},error:i=>console.error("Error fetching QR code:",i)})}downloadDocument(){}updateEmailSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updateEmailRequest(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil",`Kami telah mengirimkan email verifikasi ke ${e.email}. Silakan buka tautan untuk menyelesaikan proses.`,"success")},error:i=>this.errorHandlerService.alertError(i)})}updatePasswordSubmit(e){this.sweetalertService.loading("Mohon tunggu","Proses..."),this.authService.updatePassword(e).subscribe({next:()=>{this.sweetalertService.alert("Berhasil","Password berhasil diubah","success")},error:i=>this.errorHandlerService.alertError(i)})}setParticipantData(e){this.participant=e,this.verticalTableData=this.transformData(this.participant),this.editLink=`/participants/${this.id}/edit`,this.idCardLink=`/participants/${this.id}/id-card`,this.qrCodeDownloadName=`QR_Code_${e.name.replace(/ /g,"_")}_${e.id}.png`,this.userProfile.role.name==="user"&&localStorage.setItem("user_profile",JSON.stringify(H(z({},this.userProfile),{participant:this.participant}))),this.participant&&(this.getFoto(this.participant.id),this.getQrCode(this.participant.id))}transformData(e){return[{label:"No Pegawai",value:e.idNumber??"-"},{label:"Nama Peserta",value:e.name},{label:"Dinas",value:e.dinas??"-"},{label:"Bidang",value:e.bidang??"-"},{label:"Perusahaan",value:e.company??"-"},{label:"Email",value:e.email},{label:"No Telp",value:e.phoneNumber??"-"},{label:"Tempat Lahir",value:e.placeOfBirth??"-"},{label:"Tanggal Lahir",value:new Date(e.dateOfBirth).toLocaleDateString("id-ID",this.dateOptions)},{label:"SIM A",link:`/participants/${e.id}/sim-a`},{label:"SIM B",link:`/participants/${e.id}/sim-b`},{label:"KTP",link:`/participants/${e.id}/ktp`},{label:"Exp Surat Sehat & Buta Warna",value:new Date(new Date(e.tglKeluarSuratSehatButaWarna).setMonth(new Date(e.tglKeluarSuratSehatButaWarna).getMonth()+6)).toLocaleDateString("id-ID",this.dateOptions),link:`/participants/${e.id}/surat-sehat-buta-warna`},{label:"Exp Surat Bebas Narkoba",value:new Date(new Date(e.tglKeluarSuratBebasNarkoba).setMonth(new Date(e.tglKeluarSuratBebasNarkoba).getMonth()+6)).toLocaleDateString("id-ID",this.dateOptions),link:`/participants/${e.id}/surat-bebas-narkoba`}]}getMediaType(e){let i=e.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);return i&&i.length>0?i[1]:""}static{this.\u0275fac=function(i){return new(i||a)(c(x),c(B),c(k),c(Ke),c(D),c(R))}}static{this.\u0275cmp=y({type:a,selectors:[["app-participant-detail"]],decls:4,vars:3,consts:[[1,"container"],["class","error-message",4,"ngIf"],[1,"section"],[1,"profile-section"],[1,"photo"],["alt","Profile Picture",1,"file",3,"src"],[1,"name"],[1,"qr-section"],[1,"qr-code"],["alt","QR Code",1,"file",3,"src"],[1,"download"],[3,"routerLink",4,"appRoleBasedAccess"],[1,"data-section"],["class","settings-nav",4,"appRoleBasedAccess"],[1,"card"],[3,"isParticipantDetail","data"],[1,"account-form"],[1,"certificate-table"],[3,"columns","data"],[1,"button-container"],["class","button",3,"routerLink",4,"appRoleBasedAccess"],[1,"error-message"],[3,"routerLink"],[1,"settings-nav"],[1,"menu-setting-item",3,"ngClass","routerLink"],[1,"fa-solid","fa-user"],[1,"fa-solid","fa-user-gear"],[3,"downloadDocumentClick","isParticipantDetail","data"],[1,"form-content"],["cardTitle","Ubah Email",3,"formSubmit"],["cardTitle","Ubah Password",3,"formSubmit"],[1,"button",3,"routerLink"]],template:function(i,t){i&1&&(b(0,"app-header"),r(1,"div",0),h(2,Dt,1,0,"app-loader")(3,Wt,23,15),o()),i&2&&(l(),Re("loading",t.isLoading),l(),F(t.isLoading?2:3))},dependencies:[Q,ge,ot,at,nt,S,We,E,G,pt,st,he,q],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:2em;padding:2em}.container.loading[_ngcontent-%COMP%]{justify-content:center;align-items:center;height:50%;width:100%}.section[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:40%}.profile-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.photo[_ngcontent-%COMP%]{max-width:148px;max-height:100%}.name[_ngcontent-%COMP%]{font-size:1em;margin-top:10px}.qr-section[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1em}.file[_ngcontent-%COMP%]{width:100%;height:100%}.file.blank[_ngcontent-%COMP%]{border:1px solid #fff}.qr-code[_ngcontent-%COMP%]{max-width:180px;max-height:180px}.download[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:25px;font-size:1em;font-weight:700;text-decoration:underline}.data-section[_ngcontent-%COMP%]{display:flex;gap:1em}.settings-nav[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:top;font-size:1em;width:12%}.settings-nav[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:50px}.menu-setting-item[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;gap:10px;cursor:pointer;transition:background-color .2s ease,border-left .2s ease}.menu-setting-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:1em}.menu-setting-item[_ngcontent-%COMP%]:hover{background-color:#d8dadb}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:5px solid #02507E}.card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;height:100%;width:100%;background-color:#fff}.account-form[_ngcontent-%COMP%]{display:flex;padding:20px;gap:5%}.form-content[_ngcontent-%COMP%]{margin:0;width:100%;height:auth;padding-right:10%}.certificate-table[_ngcontent-%COMP%]{width:100%;padding:20px;border:1px solid #e0e0e0;border-radius:8px;background-color:#fff}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4em;width:100%}.button[_ngcontent-%COMP%]{width:190px;height:45px}.download[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#000}.download[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{cursor:pointer;color:#266e99}.section[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center}.section[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{cursor:pointer;color:#266e99}@media (max-width: 768px){.container[_ngcontent-%COMP%]{padding:1em}.qr-section[_ngcontent-%COMP%]{flex-direction:column}.data-section[_ngcontent-%COMP%]{flex-direction:column;gap:1em}.settings-nav[_ngcontent-%COMP%]{flex-direction:row;width:50%}.menu-setting-item.active[_ngcontent-%COMP%]{border-left:none;border-bottom:5px solid #02507E}.account-form[_ngcontent-%COMP%]{flex-direction:column;gap:3em}}"]})}}return a})();var ve=(()=>{class a{constructor(e,i,t,n,d){this.route=e,this.router=i,this.participantService=t,this.sweetalertService=n,this.errorHandlerService=d,this.updateParticipant={idNumber:"",name:"",nik:"",dinas:"",bidang:"",company:"",phoneNumber:"",nationality:"",placeOfBirth:"",dateOfBirth:"",simA:null,simAFileName:"",simB:null,simBFileName:"",ktp:null,ktpFileName:"",foto:null,fotoFileName:"",suratSehatButaWarna:null,suratSehatButaWarnaFileName:"",suratBebasNarkoba:null,suratBebasNarkobaFileName:"",tglKeluarSuratSehatButaWarna:null,tglKeluarSuratBebasNarkoba:null},this.participantId=this.route.snapshot.paramMap.get("participantId"),this.selectedCompany="",this.companyName="",this.showCompanyInput=!1,this.requiredFields=["name","company","email","phoneNumber","kewarganegaraan","placeOfBirth","dateOfBirth","simA","ktp","foto","suratSehatButaWarna","tglKeluarSuratSehatButaWarna","suratBebasNarkoba","tglKeluarSuratSehatBebasNarkoba"],this.userProfile=JSON.parse(localStorage.getItem("user_profile")||"{}"),this.id=this.route.snapshot.paramMap.get("participantId")||this.userProfile.participant.id,this.backButtonRoute="/participants"}ngOnInit(){this.participantId&&this.userProfile!=="{}"&&(this.userProfile.role==="user"?this.getParticipantFromLocalStorage():this.getParticipantById()),this.route.queryParams.subscribe(e=>{e.showAlert&&(this.sweetalertService.alert("Peringatan","Anda tidak bisa mengakses halaman lain sebelum melengkapi data","warning"),this.router.navigate([],{relativeTo:this.route,queryParams:{showAlert:null},queryParamsHandling:"merge"}))}),this.id&&this.userProfile.role.name==="user"&&(this.backButtonRoute=`/participants/${this.id}/profile/personal`)}getParticipantFromLocalStorage(){let e=this.userProfile.participant;e&&this.setParticipantData(e)}getParticipantById(){this.participantId&&this.participantService.getParticipantById(this.participantId).subscribe({next:e=>{let i=e.data;i&&this.setParticipantData(i)},error:e=>console.log(e)})}onUpdate(e){if(this.participantId){let i=this.prepareFormData(e);this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.updateParticipant(this.participantId,i).subscribe({next:()=>{this.sweetalertService.alert("Diperbarui!","Peserta berhasil diperbarui","success");let t=this.userProfile.participant;if(t){let n=t.email;this.userProfile.participant=JSON.parse(JSON.stringify(e,(d,p)=>p instanceof File||p===null?void 0:p)),this.userProfile.participant.email=n,this.userProfile.isDataComplete=!0,localStorage.setItem("user_profile",JSON.stringify(this.userProfile))}this.userProfile.role.name==="user"?(localStorage.removeItem("pas_foto"),localStorage.removeItem("qr_code"),this.router.navigateByUrl(`/participants/${this.participantId}/profile/personal`)):this.router.navigateByUrl(`/participants/${this.participantId}/detail`)},error:t=>{console.log(t),this.errorHandlerService.alertError(t,this.requiredFields)}})}}onFileChange(e,i){if(i){this.updateParticipant[e]=i;let t=`${e}FileName`;this.updateParticipant[t]=i.name}}setParticipantData(e){this.updateParticipant=H(z({},e),{dateOfBirth:this.formatDateToISO(e.dateOfBirth),tglKeluarSuratSehatButaWarna:this.formatDateToISO(e.tglKeluarSuratSehatButaWarna),tglKeluarSuratBebasNarkoba:this.formatDateToISO(e.tglKeluarSuratBebasNarkoba)}),this.selectedCompany=e.gmfNonGmf?e.gmfNonGmf:e.company,(e.gmfNonGmf!=="GMF"||e.company!=="GMF")&&(this.companyName=e.company,this.showCompanyInput=!!this.companyName,this.companyName||(this.selectedCompany="GMF",this.companyName="GMF",this.showCompanyInput=!1))}prepareFormData(e){let i=new FormData;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];n==null&&(n=""),n instanceof File,i.append(t,n)}return i}formatDateToISO(e){return new Date(e).toISOString().split("T")[0]}static{this.\u0275fac=function(i){return new(i||a)(c(x),c(B),c(k),c(D),c(R))}}static{this.\u0275cmp=y({type:a,selectors:[["app-edit-participant-data"]],viewQuery:function(i,t){if(i&1&&V(K,5),i&2){let n;W(n=U())&&(t.companyInputComponent=n.first)}},inputs:{selectedCompany:"selectedCompany",companyName:"companyName",showCompanyInput:"showCompanyInput"},decls:1,vars:7,consts:[[3,"formSubmit","fileChange","pageTitle","selectedCompany","companyName","showCompanyInput","participant","isUpdate","backButtonRoute"]],template:function(i,t){i&1&&(r(0,"app-participant-form",0),_("formSubmit",function(d){return t.onUpdate(d)})("fileChange",function(d){return t.onFileChange(d.property,d.file)}),o()),i&2&&s("pageTitle","Edit Participant Data")("selectedCompany",t.selectedCompany)("companyName",t.companyName)("showCompanyInput",t.showCompanyInput)("participant",t.updateParticipant)("isUpdate",!0)("backButtonRoute",t.backButtonRoute)},dependencies:[ye],encapsulation:2})}}return a})();var mt=gt(ht());var Ut=["*"],$t=a=>({height:a});function Kt(a,C){a&1&&b(0,"app-loader")}function zt(a,C){if(a&1&&(b(0,"app-title",1),r(1,"div",2),pe(2),o(),r(3,"div",3)(4,"app-white-button",4),m(5," Kembali "),o()()),a&2){let e=f();s("pageTitle",e.pageTitle),l(4),s("routerLink",e.navigationLinks)}}var Pe=(()=>{class a{constructor(){this.pageTitle="",this.navigationLinks="",this.isLoading=!1,this.downloadChange=new j}onDownloadChanged(){this.downloadChange.emit()}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-display-files"]],inputs:{pageTitle:"pageTitle",navigationLinks:"navigationLinks",isLoading:"isLoading"},outputs:{downloadChange:"downloadChange"},ngContentSelectors:Ut,decls:4,vars:4,consts:[[1,"container",3,"ngStyle"],[3,"pageTitle"],[1,"display-container"],[1,"buttons-container"],[1,"button",3,"routerLink"]],template:function(i,t){i&1&&(oe(),b(0,"app-header"),r(1,"div",0),h(2,Kt,1,0,"app-loader")(3,zt,6,2),o()),i&2&&(l(),s("ngStyle",$(2,$t,t.isLoading?"50%":"auto")),l(),F(t.isLoading?2:3))},dependencies:[ue,q,Q,he,G,S,Ue],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:2em;padding:1em}.display-container[_ngcontent-%COMP%]{width:100%;height:100%;padding:5px;border-radius:25px;border:4px #02507E solid;display:flex;justify-content:center;align-items:center;gap:5em;overflow:auto}.buttons-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.button[_ngcontent-%COMP%]{width:190px;height:45px}@media (max-width: 768px){.button-container[_ngcontent-%COMP%]{width:100%;margin-top:2em}.button[_ngcontent-%COMP%]{max-width:40%}}"]})}}return a})();function Qt(a,C){if(a&1&&b(0,"div",1),a&2){let e=f();s("innerHTML",e.id_card,Oe)}}function Gt(a,C){a&1&&(r(0,"div",2)(1,"p"),m(2,"ID Card Error. Silahkan cek kembali apakah data anda sudah lengkap atau belum."),o()())}var we=(()=>{class a{constructor(e,i,t,n,d){this.route=e,this.participantService=i,this.sanitizer=t,this.sweetalertService=n,this.errorHandlerService=d,this.id_card="",this.id=this.route.snapshot.paramMap.get("participantId"),this.navigationLink=`/participants/${this.id}/detail`,this.isLoading=!1}ngOnInit(){this.getIdCard()}getIdCard(){if(!this.id){this.sweetalertService.alert("Peringatan","ID tidak ditemukan.","warning");return}this.isLoading=!0,this.participantService.viewIdCard(this.id).subscribe({next:e=>{this.id_card=this.sanitizer.bypassSecurityTrustHtml(e)},error:e=>{console.log(e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}downloadIdCard(){if(!this.id){this.sweetalertService.alert("Peringatan","ID tidak ditemukan.","warning");return}this.sweetalertService.loading("Mohon tunggu","Proses..."),this.participantService.getParticipantById(this.id).pipe(ie(()=>this.sweetalertService.close())).subscribe({next:e=>{if(e.data){let n=`ID_Card_${e.data.name.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_-]/g,"")}_${this.id}.pdf`;this.participantService.downloadIdCard(this.id).subscribe({next:d=>{d?((0,mt.saveAs)(d,n),console.log(`File saved as: ${n}`)):this.sweetalertService.alert("Gagal!","Tidak ada data untuk diunduh.","error")},error:d=>{console.error("Error saat mengunduh ID Card:",d),this.errorHandlerService.alertError(d)}})}else this.sweetalertService.alert("Gagal!","Data peserta tidak ditemukan.","error")},error:e=>{console.error("Error saat mengambil detail peserta:",e),this.errorHandlerService.alertError(e)}})}static{this.\u0275fac=function(i){return new(i||a)(c(x),c(k),c(le),c(D),c(R))}}static{this.\u0275cmp=y({type:a,selectors:[["app-id-card"]],decls:3,vars:3,consts:[[3,"isLoading","navigationLinks"],[3,"innerHTML"],[1,"no-files"]],template:function(i,t){i&1&&(r(0,"app-display-files",0),h(1,Qt,1,1,"div",1)(2,Gt,3,0,"div",2),o()),i&2&&(s("isLoading",t.isLoading)("navigationLinks",t.navigationLink),l(),F(t.id_card?1:2))},dependencies:[Pe],styles:[".no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}"]})}}return a})();function Jt(a,C){if(a&1){let e=N();r(0,"embed",4),_("load",function(){u(e);let t=f(2);return g(t.onImageLoad())})("error",function(){u(e);let t=f(2);return g(t.onImageError())}),o()}if(a&2){let e=f(2);s("src",e.safeUrl,Ee)}}function Zt(a,C){if(a&1){let e=N();r(0,"img",5),_("load",function(){u(e);let t=f(2);return g(t.onImageLoad())})("error",function(){u(e);let t=f(2);return g(t.onImageError())}),o()}if(a&2){let e=f(2);s("src",e.safeUrl,X)}}function Yt(a,C){if(a&1&&h(0,Jt,1,1,"embed",2)(1,Zt,1,1,"img",3),a&2){let e=f();F(e.fileType==="application/pdf"?0:1)}}function Xt(a,C){a&1&&(r(0,"div",1)(1,"p"),m(2,"File tidak ditemukan!!"),o()())}var A=(()=>{class a{constructor(e,i,t,n,d,p){this.route=e,this.participantService=i,this.router=t,this.sanitizer=n,this.renderer=d,this.el=p,this.pageTitle="",this.id=this.route.snapshot.paramMap.get("participantId"),this.navigationLink="",this.fileType="",this.safeUrl="",this.cachedUserProfile=localStorage.getItem("user_profile"),this.isLoading=!1;let Y=this.router.getCurrentNavigation()?.extras.state;Y?this.navigationLink=Y.data:this.cachedUserProfile&&(JSON.parse(this.cachedUserProfile).role.name==="user"?this.navigationLink=`/participants/${this.id}/profile/personal`:this.navigationLink=`/participants/${this.id}/detail`)}ngOnInit(){let e=this.router.url,t=["sim-a","sim-b","ktp","surat-sehat-buta-warna","surat-bebas-narkoba"].find(n=>e.includes(n));t&&(this.pageTitle=t.toUpperCase().split("-").join(" "),this.id&&this.getFile(this.id,t))}getFile(e,i){this.isLoading=!0,this.participantService.getFile({id:e},i).pipe(ae(t=>(this.fileType=this.getMediaType(t),new Promise((n,d)=>{let p=new FileReader;p.onloadend=()=>n(p.result),p.onerror=d,p.readAsDataURL(t)}))),ie(()=>{this.isLoading=!1})).subscribe({next:t=>{this.file=t.split(",")[1],this.fileType==="application/pdf"?this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${this.file}#toolbar=0`):this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`data:${this.fileType};base64,${this.file}`)},error:t=>{console.log(t)}})}onImageLoad(){this.isLoading=!1}onImageError(){console.log("Failed to load image:",this.safeUrl),this.isLoading=!1}getMediaType(e){return e.type==="application/pdf"?"application/pdf":e.type==="image/jpeg"?"image/jpeg":e.type==="image/png"?"image/png":e.type==="image/gif"?"image/gif":e.type==="image/bmp"?"image/bmp":e.type==="image/webp"?"image/webp":"application/octet-stream"}getDownloadExtension(){switch(this.fileType){case"image/png":return".png";case"image/jpeg":return".jpeg";case"image/gif":return".gif";case"image/bmp":return".bmp";case"image/webp":return".webp";case"application/pdf":return".pdf";default:return""}}downloadFile(){if(!this.file||!this.fileType){console.error("File content or type is missing, cannot download.");return}let e=`data:${this.fileType};base64,${this.file}`,i=this.renderer.createElement("a");this.renderer.setAttribute(i,"href",e),this.renderer.setAttribute(i,"download",`${(this.pageTitle||"file").replace(/\s+/g,"_")}${this.getDownloadExtension()}`),this.renderer.appendChild(this.el.nativeElement,i),i.click(),this.renderer.removeChild(this.el.nativeElement,i)}static{this.\u0275fac=function(i){return new(i||a)(c(x),c(k),c(B),c(le),c(Le),c(De))}}static{this.\u0275cmp=y({type:a,selectors:[["app-displays-participant-file"]],decls:3,vars:3,consts:[[3,"isLoading","navigationLinks"],[1,"no-files"],["loading","lazy","type","application/pdf",1,"pdf",3,"src"],["loading","lazy",1,"image",3,"src"],["loading","lazy","type","application/pdf",1,"pdf",3,"load","error","src"],["loading","lazy",1,"image",3,"load","error","src"]],template:function(i,t){i&1&&(r(0,"app-display-files",0),h(1,Yt,2,1)(2,Xt,3,0,"div",1),o()),i&2&&(s("isLoading",t.isLoading)("navigationLinks",t.navigationLink),l(),F(t.safeUrl?1:2))},dependencies:[Pe,S],styles:[".image[_ngcontent-%COMP%]{max-width:100%;max-height:100%}.pdf[_ngcontent-%COMP%]{width:40%;min-height:100vh}.no-files[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-size:2em;height:50vh}a[_ngcontent-%COMP%]{position:relative;color:#266e99;font-weight:700;font-size:22px}a[_ngcontent-%COMP%]{cursor:pointer;text-decoration:underline}a[_ngcontent-%COMP%]:hover{color:purple}"]})}}return a})();var ei=[{path:"add",component:be,canActivate:[M,I],data:{roles:["super admin","supervisor","lcu"]}},{path:":participantId/detail",component:Z,canActivate:[M,I,O],data:{roles:["super admin","supervisor","lcu"]}},{path:":participantId/profile/personal",component:Z,canActivate:[M,I,O],data:{roles:["user"]}},{path:":participantId/profile/account",component:Z,canActivate:[M,I,O],data:{roles:["user"]}},{path:":participantId/edit",component:ve,canActivate:[M,I],data:{roles:["super admin","lcu","user"]}},{path:":participantId/id-card",component:we,canActivate:[M,I],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/sim-a",component:A,canActivate:[M,I,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/sim-b",component:A,canActivate:[M,I,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/ktp",component:A,canActivate:[M,I,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/surat-sehat-buta-warna",component:A,canActivate:[M,I,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:":participantId/surat-bebas-narkoba",component:A,canActivate:[M,I,O],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"",component:Ce,canActivate:[M,I],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"**",redirectTo:"",pathMatch:"full"}],ct=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=re({type:a})}static{this.\u0275inj=ne({imports:[Se.forChild(ei),Se]})}}return a})();var $a=(()=>{class a{static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275mod=re({type:a})}static{this.\u0275inj=ne({imports:[S,L,tt,ct,Ce,be,Z,ve,we,A]})}}return a})();export{$a as ParticipantModule};
