import{a as H}from"./chunk-4R45QQZ3.js";import{a,b as G}from"./chunk-W5GHEU6T.js";import{A as I,B as P,C as B,g as w,j as T,m as b,n as S,q as x,s as y,t as h,w as $,x as D,y as E}from"./chunk-3V2U2C6V.js";import{A as C,B as d,M as m,N as A,Sa as M,X as p,Xa as R,l as g,m as v,pb as k,q as c}from"./chunk-VF5RWILG.js";var j=[{path:"",pathMatch:"full",redirectTo:"dashboard"},{path:"auth",loadChildren:()=>import("./chunk-I3YY7HSX.js").then(t=>t.AuthModule)},{path:"login",redirectTo:"auth/login",pathMatch:"full"},{path:"register",redirectTo:"auth/register",pathMatch:"full"},{path:"password-reset",redirectTo:"auth/password-reset",pathMatch:"full"},{path:"reset/:token",redirectTo:"auth/reset/:token",pathMatch:"full"},{path:"verification",redirectTo:"auth/verification",pathMatch:"full"},{path:"verify",redirectTo:"auth/verify",pathMatch:"full"},{path:"dashboard",loadChildren:()=>import("./chunk-4KEI3BL4.js").then(t=>t.DashboardModule)},{path:"participants",loadChildren:()=>import("./chunk-D77B425H.js").then(t=>t.ParticipantModule),canActivate:[a]},{path:"capability",loadChildren:()=>import("./chunk-C5Z7IWP7.js").then(t=>t.CapabilityModule),canActivate:[a,G,H],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"cot",loadChildren:()=>import("./chunk-GDJJO2SH.js").then(t=>t.CotModule),canActivate:[a]},{path:"users",loadChildren:()=>import("./chunk-G3J5RFP6.js").then(t=>t.UsersModule),canActivate:[a]},{path:"e-sign",loadChildren:()=>import("./chunk-MGEKKICZ.js").then(t=>t.ESignModule),canActivate:[a]},{path:"curriculum-syllabus",loadChildren:()=>import("./chunk-K7NUYMJ7.js").then(t=>t.CurriculumSyllabusModule),canActivate:[a]},{path:"home",redirectTo:"dashboard",pathMatch:"full"},{path:"not-found",loadComponent:()=>import("./chunk-HQGNOZM6.js").then(t=>t.NotFoundComponent)},{path:"**",redirectTo:"not-found"}];var F=(t,i)=>{let e=p(P),o=p(h),l=p(B),n=!1,u=new v(null),s=e.getUserProfile()?.accessToken;return s&&(t=t.clone({setHeaders:{Authorization:`Bearer ${s}`}})),i(t).pipe(d(f=>f.status===401&&!t.url.includes("/token")?N(t,i,e,o,l,n,u):c(()=>f)))},N=(t,i,e,o,l,n,u)=>n?u.pipe(m(r=>{if(r){let s=t.clone({setHeaders:{Authorization:`Bearer ${r}`}});return i(s)}return z(o,e),l.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),c(()=>new Error("Token refresh failed"))})):(n=!0,u.next(null),e.refreshToken().pipe(m(r=>{console.log("AuthInterceptor: Refresh Token Response",r),n=!1,u.next(r.data.accessToken||null);let s=t.clone({setHeaders:{Authorization:`Bearer ${r.data.accessToken}`}});return i(s)}),d(r=>(n=!1,z(o,e),l.alert("Selamat Datang!","Sesi tidak ditemukan, sudah mencoba login?","warning"),o.navigate(["/login"]),c(()=>r))))),z=(t,i)=>{localStorage.clear(),t.navigate(["/login"])};var U={providers:[D(j,E($)),b(S([F]))]};var L=(()=>{class t{constructor(e){this.router=e,this.title="GMF Aeroasia",this.isAuthRoute=!1,this.destroy$=new g,this.excludedRoutes=["/login","/register","/password-reset","/verification","/users/add","/auth/login","/auth/register","/auth/password-reset","/auth/verification"],this.excludedRoutesRegex=[/^\/users\/[a-f0-9\-]+\/edit(\?.*)?$/,/^\/reset\/[^/]+(\?.*)?$/]}ngOnInit(){this.checkCurrentRoute(),this.router.events.pipe(C(e=>e instanceof x),A(this.destroy$)).subscribe(()=>this.checkCurrentRoute())}checkCurrentRoute(){let e=this.router.url.split("?")[0];this.isAuthRoute=this.excludedRoutes.includes(e)||this.excludedRoutesRegex.some(o=>o.test(e))}static{this.\u0275fac=function(o){return new(o||t)(M(h))}}static{this.\u0275cmp=R({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(o,l){o&1&&k(0,"router-outlet")},dependencies:[y,w],encapsulation:2})}}return t})();I.production&&(console.log=()=>{},console.debug=()=>{},console.info=()=>{},console.warn=()=>{});T(L,U).catch(t=>console.error(t));
