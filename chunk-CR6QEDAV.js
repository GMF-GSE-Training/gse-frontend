import{a as D,b as m}from"./chunk-W33JTFV4.js";import{a as P}from"./chunk-X7M2VWZO.js";import{a as O}from"./chunk-5HRMLZSQ.js";import"./chunk-ODNHARAG.js";import"./chunk-LLJUXWRW.js";import"./chunk-DGMD3CVT.js";import{a as l,b as c}from"./chunk-S5LCZXWF.js";import{a as K}from"./chunk-2RU2G2GG.js";import{a as j,c as g}from"./chunk-ERSWCUUE.js";import{o as v,p as H}from"./chunk-HA77R4EW.js";import{g as U,l as V,r as $,t as C,z as N}from"./chunk-PTR267HX.js";import{R as M,S as y,Sa as a,W as x,Xa as b,Ya as h,a as o,ab as T,b as u,ba as A,ca as R,hb as f,jb as F,nb as s,ob as n,pb as B,sb as L,vb as S,wb as w}from"./chunk-NHTCOLVS.js";var I=(()=>{class e{constructor(t){this.http=t,this.apiUrl=j.apiUrl,this.endpoints=j.endpoints.curriculumSyllabus}createCurriculumSyllabus(t){return this.http.post(`${this.apiUrl}/${this.endpoints.base}`,t,{withCredentials:!0})}updateCurriculumSyllabus(t,i){return this.http.patch(`${this.apiUrl}/${this.endpoints.base}/${t}`,i,{withCredentials:!0})}static{this.\u0275fac=function(i){return new(i||e)(x(V))}}static{this.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var _=(()=>{class e{constructor(t,i,r,p){this.router=t,this.curriculumSyllabusService=i,this.sweetalertService=r,this.errorHandlerService=p,this.capability={id:"",ratingCode:"",trainingCode:"",trainingName:""},this.regulasiGSEs=[{capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:"Regulasi GSE"}],this.kompetensis=[{capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:"Kompetensi"}];let d=this.router.getCurrentNavigation()?.extras.state;d&&(this.capability.id=d.id||"",this.capability.ratingCode=d.ratingCode||"",this.capability.trainingName=d.trainingName||"",this.regulasiGSEs[0].capabilityId=this.capability.id,this.kompetensis[0].capabilityId=this.capability.id)}onSubmit(){this.regulasiGSEs=this.regulasiGSEs.map(i=>u(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)})),this.kompetensis=this.kompetensis.map(i=>u(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)}));let t=[...this.regulasiGSEs,...this.kompetensis];this.curriculumSyllabusService.createCurriculumSyllabus({curriculumSyllabus:t}).subscribe({next:i=>{this.sweetalertService.alert("Berhasil",i.data,"success"),this.router.navigateByUrl("/capability")},error:i=>{console.error("Error saving Curriculum & Syllabus",i),this.errorHandlerService.alertError(i)}})}static{this.\u0275fac=function(i){return new(i||e)(a(C),a(I),a(g),a(K))}}static{this.\u0275cmp=b({type:e,selectors:[["app-add-curriculum"]],decls:1,vars:5,consts:[[3,"formSubmit","pageTitle","capability","regulasiGSEs","kompetensis","blueButtonRoute"]],template:function(i,r){i&1&&(s(0,"app-curriculum-syllabus-form",0),S("formSubmit",function(){return r.onSubmit()}),n()),i&2&&f("pageTitle","Add Curriculum & Syllabus")("capability",r.capability)("regulasiGSEs",r.regulasiGSEs)("kompetensis",r.kompetensis)("blueButtonRoute","/capability")},dependencies:[v,D],encapsulation:2})}}return e})();function X(e,J){e&1&&(s(0,"div",0),B(1,"app-loader"),n())}function Y(e,J){if(e&1){let t=L();s(0,"app-curriculum-syllabus-form",2),S("formSubmit",function(){A(t);let r=w();return R(r.onSubmit())}),n()}if(e&2){let t=w();f("pageTitle","Edit Curriculum & Syllabus")("capability",t.capability)("regulasiGSEs",t.regulasiGSEs)("kompetensis",t.kompetensis)}}var G=(()=>{class e{constructor(t,i,r,p,k){this.router=t,this.route=i,this.sweetalertService=r,this.capabilityService=p,this.curriculumSyllabusService=k,this.clas="add-button delete-button",this.capability={id:"",ratingCode:"",trainingCode:"",trainingName:""},this.regulasiGSEs=[{id:"",capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:""}],this.kompetensis=[{id:"",capabilityId:"",name:"",theoryDuration:0,practiceDuration:0,type:""}],this.capabilityId=this.route.snapshot.paramMap.get("capabilityId"),this.isLoading=!1}ngOnInit(){this.getCapabilityById()}getCapabilityById(){this.capabilityId&&(this.isLoading=!0,this.capabilityService.getCurriculumSyllabus(this.capabilityId).subscribe({next:t=>{if(typeof t.data=="object"){let i=t.data;this.capability={id:i.id,ratingCode:i.ratingCode,trainingCode:i.trainingCode,trainingName:i.trainingName},this.regulasiGSEs=this.mapSyllabus(i.curriculumSyllabus,"Regulasi GSE"),this.kompetensis=this.mapSyllabus(i.curriculumSyllabus,"Kompetensi")}},error:t=>{console.log(t),this.isLoading=!1},complete:()=>{this.isLoading=!1}}))}mapSyllabus(t,i){return t.filter(r=>r.type===i).map(r=>({id:r.id,capabilityId:r.capabilityId,name:r.name,theoryDuration:r.theoryDuration,practiceDuration:r.practiceDuration,type:r.type}))}onSubmit(){this.regulasiGSEs=this.regulasiGSEs.map(i=>u(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)})),this.kompetensis=this.kompetensis.map(i=>u(o({},i),{theoryDuration:Number(i.theoryDuration),practiceDuration:Number(i.practiceDuration)}));let t=[...this.regulasiGSEs,...this.kompetensis];+this.curriculumSyllabusService.updateCurriculumSyllabus(this.capability.id,{curriculumSyllabus:t}).subscribe({next:i=>{this.sweetalertService.alert("Berhasil",i.data,"success"),this.router.navigateByUrl("/capability")},error:i=>{console.error(i)}})}static{this.\u0275fac=function(i){return new(i||e)(a(C),a($),a(g),a(P),a(I))}}static{this.\u0275cmp=b({type:e,selectors:[["app-edit-curriculum-syllabus"]],decls:2,vars:1,consts:[[1,"loading-container"],[3,"pageTitle","capability","regulasiGSEs","kompetensis"],[3,"formSubmit","pageTitle","capability","regulasiGSEs","kompetensis"]],template:function(i,r){i&1&&T(0,X,2,0,"div",0)(1,Y,1,4,"app-curriculum-syllabus-form",1),i&2&&F(r.isLoading?0:1)},dependencies:[D,O],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:50vh}"]})}}return e})();var Z=[{path:"add",component:_,canActivate:[l,c],data:{roles:["super admin"]}},{path:":capabilityId/edit",component:G,canActivate:[l,c],data:{roles:["super admin"]}},{path:":capabilityId/view",component:m,canActivate:[l,c],data:{roles:["super admin","supervisor","lcu","user"]}},{path:"",component:m,canActivate:[l,c],data:{roles:["super admin","supervisor","lcu","user"]}}],z=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=h({type:e})}static{this.\u0275inj=y({imports:[N.forChild(Z),N]})}}return e})();var _i=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=h({type:e})}static{this.\u0275inj=y({imports:[U,v,H,z,_,G,m]})}}return e})();export{_i as CurriculumSyllabusModule};
